define(["jquery","bsp-utils","pixastic/pixastic.core","pixastic/actions/blurfast","pixastic/actions/brightness","pixastic/actions/crop","pixastic/actions/desaturate","pixastic/actions/fliph","pixastic/actions/flipv","pixastic/actions/invert","pixastic/actions/rotate","pixastic/actions/sepia","pixastic/actions/sharpen"],function(t,e){var i="x y width height texts textSizes textXs textYs textWidths".split(" "),a="aaaf7c5a9e604daaa126f11e23e321d8";e.onDomInsert(document,".imageEditor",{insert:function(e){var n=t(e),s=n.closest("form"),r=n.find(".imageEditor-image img"),o=r.attr("src"),d=void 0!==r.attr("data-scale")&&""!==r.attr("data-scale")?r.attr("data-scale"):1,h=r,p=r.clone(),l=p[0],f=n.find(".imageEditor-tools ul"),c=n.find(".imageEditor-edit"),u=n.parents(".inputContainer").attr("data-name"),v=t("<li/>",{html:t("<a/>",{"class":"action-image-edit",text:"Edit Image",click:function(){return c.popup("source",t(this)),c.popup("open"),t(".imageEditor-edit input[name='"+u+".blur']").each(function(){var e=t(this).val().split("x");b(this,e[0],e[1],e[2],e[3])}),!1}})});f.prepend(v);var g=t("<div/>");v.append(g);var m,x,w=function(){var e={},i=function(t){var i=t.is(":checkbox")?t.is(":checked"):parseFloat(t.val());if(i!==!1&&!isNaN(i)){var a=/.([^.]+)$/.exec(t.attr("name"));if(a=a?a[1]:null,"brightness"===a)e.brightness=e.brightness||{},e.brightness.brightness=150*i,e.brightness.legacy=!0;else if("contrast"===a)e.brightness=e.brightness||{},e.brightness.contrast=0>i?i:3*i;else if("flipH"===a)e.fliph=e.fliph||{};else if("flipV"===a)e.flipv=e.flipv||{};else if("grayscale"===a)e.desaturate=e.desaturate||{};else if("invert"===a)e.invert=e.invert||{};else if("rotate"===a)e.rotate=e.rotate||{},e.rotate.angle=-i;else if("sepia"===a)e.sepia=e.sepia||{};else if("sharpen"===a)e.sharpen=e.sharpen||{},e.sharpen.amount=i;else if("blur"===a){e.blurfast=e.blurfast||{count:0,data:[]};var n=t.val().split("x"),s={left:n[0],top:n[1],width:n[2],height:n[3]};e.blurfast.data[e.blurfast.count]={amount:1,rect:s},e.blurfast.count++}}};c.find(":input[name$='.rotate']").each(function(){i(t(this))}),c.find(":input:not([name$='.rotate'])").each(function(){i(t(this))});var a=JSON.stringify(e);if(a!==m){m=a,g.empty(),c.find(":input").each(function(){var e=t(this);(!e.is(":checkbox")||e.is(":checked"))&&g.append(t("<input/>",{type:"hidden",name:e.attr("name"),value:e.val()}))});var n=[];for(var s in e)e.hasOwnProperty(s)&&(n[n.length]=s);var o=function(t,e,i,a,n){n<a.length?Pixastic.process(t,i,a[n],function(t){++n,o(t,e,i,a,n)}):(++e,d(t,e))},d=function(i,a){if(a<n.length){var s=n[a];void 0!==e[s].count?o(i,a,s,e[s].data,0):Pixastic.process(i,s,e[s],function(t){++a,d(t,a)})}else r!==h&&r.remove(),h.before(i),h.hide(),r=t(i),x=setTimeout(w,100)};d(l,0)}else x=setTimeout(w,100)};w(),c.popup("container").bind("open",function(){w()}),c.popup("container").bind("close",function(){x&&clearTimeout(x)});var y=t("<button/>",{text:"Reset",click:function(){return c.find(":input").each(function(){var e=t(this);e.is(":checkbox")?e.removeAttr("checked"):e.val(0)}),n.find(".imageEditor-blurOverlay").remove(),w(),!1}}),E=0,b=function(e,i,a,s,o){E++;var d;null===e?(d=t("<input>",{type:"hidden",name:u+".blur",value:i+"x"+a+"x"+s+"x"+o}),c.append(d)):d=t(e);var h=t("<div/>",{"class":"imageEditor-blurOverlay",css:{height:o+"px",left:i+"px",position:"absolute",top:a+"px",width:s+"px","z-index":1}}),p=t("<div/>",{"class":"imageEditor-blurOverlayBox",css:{height:o+"px",position:"absolute",width:s+"px","z-index":1,outline:"1px dashed #fff"}}),l=t("<div/>",{"class":"imageEditor-textOverlayLabel",text:"Blur #"+E}),f=s/o,v=function(e){return function(i){var a=p.parent().position(),n={left:a.left,top:a.top,width:p.width(),height:p.height(),pageX:i.pageX,pageY:i.pageY},s=r.width(),o=r.height();return t.drag(this,i,function(t){},function(t){var i=t.pageX-n.pageX,a=t.pageY-n.pageY,r=e(t,n,{x:i,y:a,constrainedX:Math.max(i,a*f),constrainedY:Math.max(a,i/f)});for(key in n)r[key]=r[key]||n[key];var d;r.moving?(r.left<0&&(r.left=0),r.top<0&&(r.top=0),d=r.left+r.width-s,d>0&&(r.left-=d),d=r.top+r.height-o,d>0&&(r.top-=d)):((r.width<10||r.height<10)&&(f>1?(r.width=10*f,r.height=10):(r.width=10,r.height=10/f)),r.left<0&&(r.width+=r.left,r.height=r.width/f,r.top-=r.left/f,r.left=0),r.top<0&&(r.height+=r.top,r.width=r.height*f,r.left-=r.top*f,r.top=0),d=r.left+r.width-s,d>0&&(r.width-=d,r.height=r.width/f),d=r.top+r.height-o,d>0&&(r.height-=d,r.width=r.height*f)),h.css(r),p.css("width",r.width),p.css("height",r.height)},function(){var t=p.parent().position();d.attr("value",t.left+"x"+t.top+"x"+p.width()+"x"+p.height())}),!1}};p.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-left",mousedown:v(function(t,e,i){return{left:e.left+i.x,width:e.width-i.x}})})),p.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-right",mousedown:v(function(t,e,i){return{left:e.left,width:e.width+i.x}})})),p.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-bottomRight",mousedown:v(function(t,e,i){return{width:e.width+i.constrainedX,height:e.height+i.constrainedY}})})),h.append(p),l.mousedown(v(function(t,e,i){return{moving:!0,left:e.left+i.x,top:e.top+i.y}})),h.append(l);var g=t("<div/>",{"class":"imageEditor-textOverlayRemove",text:"Remove",click:function(){var e=h.css("left"),i=h.css("top"),a=h.css("width"),n=h.css("height");t(".imageEditor-blurOverlay").each(function(){var s=t(this);s.css("left")===e&&s.css("top")===i&&s.css("width")===a&&s.css("height")===n&&s.remove()});var s=d,r=t(s).attr("value"),o=t(s).attr("name");return t("input[name='"+o+"'][value='"+r+"']").remove(),d.remove(),h.remove(),!1}});h.append(g),n.append(h)};c.find(".imageEditor-addBlurOverlay").bind("click",function(){var t=n.find(".imageEditor-image canvas"),e=Math.floor(t.attr("width")/2-50),i=Math.floor(t.attr("height")/2-50),a=100,s=100;b(null,e,i,a,s)});var z=function(e,i,a,s,o){var h=t(e),p=t("<div/>",{"class":"imageEditor-hotSpotOverlay",css:{height:o+"px",left:i+"px",position:"absolute",top:a+"px",width:s+"px","z-index":1},"data-type-id":h.find('input[name$="file.hotspots.typeId"]').val()}),l=t("<div/>",{"class":"imageEditor-hotSpotOverlayBox",css:{height:o+"px",position:"absolute",width:s+"px","z-index":1}}),f=t("<div/>",{"class":"imageEditor-textOverlayLabel",text:"HotSpot"}),u=s/o,v=function(e){return function(i){var a=l.parent().position(),n={left:a.left,top:a.top,width:l.width(),height:l.height(),pageX:i.pageX,pageY:i.pageY},s=r.width(),o=r.height();return t.drag(this,i,function(t){},function(t){var i=t.pageX-n.pageX,a=t.pageY-n.pageY,r=e(t,n,{x:i,y:a,constrainedX:Math.max(i,a*u),constrainedY:Math.max(a,i/u)});for(key in n)r[key]=r[key]||n[key];var d;r.moving?(r.left<0&&(r.left=0),r.top<0&&(r.top=0),0===r.width&&(r.width=10),d=r.left+r.width-s,d>0&&(r.left-=d),d=r.top+r.height-o,d>0&&(r.top-=d)):((r.width<10||r.height<10)&&(u>1?(r.width=10*u,r.height=10):(r.width=10,r.height=10/u)),r.left<0&&(r.width+=r.left,r.height=r.width/u,r.top-=r.left/u,r.left=0),r.top<0&&(r.height+=r.top,r.width=r.height*u,r.left-=r.top*u,r.top=0),d=r.left+r.width-s,d>0&&(r.width-=d,r.height=r.width/u),d=r.top+r.height-o,d>0&&(r.height-=d,r.width=r.height*u)),p.css(r),l.css("width",r.width),l.css("height",r.height)},function(){var t=l.parent().position(),e=d,i=c.find(":input[name$='.rotate']").first().val();if(1>d)if("0"===i){var a=r.parent().find("canvas").width();e=a/1e3*e}else if("90"===i||"-90"===i){var n=r.parent().find("canvas").height();e=n/1e3*e}e=1/e;var s,o,p=parseInt(t.left*e),f=parseInt(t.top*e);if("0"===i)s=parseInt(l.width()*e),o=parseInt(l.height()*e);else if("90"===i||"-90"===i)if(o=parseInt(l.width()*e),s=parseInt(l.height()*e),"90"===i){var u=r.width()/e;f=u-p+o,p=parseInt(t.top*e)}else if("-90"===i){var u=r.height()*e;p=u-parseInt(t.top*e)-s,f=parseInt(t.left*e)}if(c.find(":input[name$='.flipH']").first().prop("checked")){var u=r.width()*e;p=u-p-s}if(c.find(":input[name$='.flipV']").first().prop("checked")){var v=r.height()*e;f=v-f-o}h.find(':input[name$="x"]').val(p),h.find(':input[name$="y"]').val(f),h.find(':input[name$="width"]').val(s),h.find(':input[name$="height"]').val(o)}),!1}};isNaN(s)?(p.css("width","10px"),p.css("height","0px")):(l.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-left",mousedown:v(function(t,e,i){return h.addClass("state-focus"),p.addClass("selected"),{left:e.left+i.x,width:e.width-i.x}})})),l.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-right",mousedown:v(function(t,e,i){return h.addClass("state-focus"),p.addClass("selected"),{left:e.left,width:e.width+i.x}})})),l.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-bottomRight",mousedown:v(function(t,e,i){return h.addClass("state-focus"),p.addClass("selected"),{width:e.width+i.constrainedX,height:e.height+i.constrainedY}})}))),p.append(l),f.mousedown(v(function(t,e,i){return h.addClass("state-focus"),p.addClass("selected"),{moving:!0,left:e.left+i.x,top:e.top+i.y}})),p.mousedown(function(){t(".imageEditor-hotSpotOverlay").removeClass("selected"),t(".state-focus").removeClass("state-focus"),h.addClass("state-focus"),p.addClass("selected")}),n.mouseleave(function(){h.removeClass("state-focus"),p.removeClass("selected")}),h.mouseover(function(){h.addClass("state-focus"),p.addClass("selected")}),h.mouseleave(function(){h.removeClass("state-focus"),p.removeClass("selected")}),p.append(f);var g=t("<div/>",{"class":"imageEditor-textOverlayRemove",text:"Remove",click:function(){var e=p.css("left"),i=p.css("top"),a=p.css("width"),n=p.css("height");return t(".imageEditor-hotSpotOverlay").each(function(){var s=t(this);s.css("left")===e&&s.css("top")===i&&s.css("width")===a&&s.css("height")===n&&s.remove()}),h.addClass("toBeRemoved"),h.find("input").attr("disabled","disabled"),p.remove(),!1}});p.append(g),n.append(p)},k=function(t,e,i,a,n){var s={};t=parseInt(t);var o=d;if(1>d){var h=r.parent().find("canvas").height();o=h/1e3*o}if(90===t){var p=r.width()/o;s.x=p-i-a,s.y=e,s.width=n,s.height=a}else if(-90===t){var l=r.height()/o;s.x=i,s.y=l-e-n,s.width=n,s.height=a}return s},$=function(){r.parents(".inputContainer").find(".imageEditor-hotSpotOverlay").remove();var e=r.parents(".inputContainer").find(".hotSpots .objectInputs");if(void 0!==e&&e.length>0){var i=d,a=c.find(":input[name$='.rotate']").first().val();if(1>d)if("0"===a){var n=r.parent().find("canvas").width();i=n/1e3*i}else if("90"===a||"-90"===a){var s=r.parent().find("canvas").height();i=s/1e3*i}e.each(function(){var e=t(this);if(!e.parents("li").first().hasClass("toBeRemoved")){var n=parseInt(e.find(':input[name$="x"]').val()),s=parseInt(e.find(':input[name$="y"]').val()),o=parseInt(e.find(':input[name$="width"]').val()),d=parseInt(e.find(':input[name$="height"]').val());if("0"!==a){var h=k(a,n,s,o,d);n=h.x,s=h.y,o=h.width,d=h.height}if(c.find(":input[name$='.flipH']").first().prop("checked")){var p=r.width()/i;n=p-n-o}if(c.find(":input[name$='.flipV']").first().prop("checked")){var l=r.height()/i;s=l-s-d}n*=i,s*=i,o*=i,d*=i,z(e.parent(),n,s,o,d)}}),r.parents(".inputContainer").find(".hotSpots").unbind("change"),r.parents(".inputContainer").find(".hotSpots").bind("change",function(){$()})}};$(),n.parents(".inputContainer").bind("create",function(){var e=parseInt(r.width()/d/2),i=parseInt(r.height()/d/2);r.parents(".inputContainer").find(".hotSpots .objectInputs").each(function(){var a=t(this);a.find(':input[name$="x"]').val(""===a.find(':input[name$="x"]').val()?e:a.find(':input[name$="x"]').val()),a.find(':input[name$="y"]').val(""===a.find(':input[name$="y"]').val()?i:a.find(':input[name$="y"]').val()),a.find(':input[name$="width"]').val(""===a.find(':input[name$="width"]').val()?100:a.find(':input[name$="width"]').val()),a.find(':input[name$="height"]').val(""===a.find(':input[name$="height"]').val()?100:a.find(':input[name$="height"]').val())}),$()}),c.find(":input[name$='.rotate']").change(function(){setTimeout($(),250)}),c.find(":input[name$='.flipH']").change(function(){setTimeout($(),250)}),c.find(":input[name$='.flipV']").change(function(){setTimeout($(),250)}),c.append(y),c.popup(),c.popup("container").addClass("imageEditor-editPopup"),c.popup("close");var O=t("<div/>",{"class":"imageEditor-cover",css:{display:"none",left:"0",position:"absolute",top:"0"}}),C=O.clone(!0),X=O.clone(!0),Y=O.clone(!0);n.append(O),n.append(C),n.append(X),n.append(Y);var I=function(t){var e=r.width(),i=r.height(),a=t.left+t.width,n=t.top+t.height;O.css({height:t.top,width:e}),C.css({height:t.height,top:t.top,width:t.left}),X.css({height:t.height,left:a,top:t.top,width:e-a}),Y.css({height:i-n,top:n,width:e}),O.show(),C.show(),X.show(),Y.show()},S=n.find(".imageEditor-sizes table"),F="true"===S.attr("data-crop-center"),T=t("<ul/>",{"class":"imageEditor-sizeSelectors"}),R={};S.find("th").each(function(){var e=t(this),d=e.closest("tr"),h=d.attr("data-size-name"),f=e.popup("source");if(f){var c=f.closest(".inputContainer").attr("data-standard-image-sizes");if(c&&t.inArray(h,c.split(" "))<0)return}var u="true"===d.attr("data-size-independent"),v=parseFloat(d.attr("data-size-width")),g=parseFloat(d.attr("data-size-height")),m=v/g,x={};t.each(i,function(t,e){x[e]=d.find(':input[name$=".'+e+'"]')});var w=Math.floor(100*m)/100,y=R[""+w];if(!u){if(y)return y.$sizeLabel.html(y.$sizeLabel.html()+'<br><span title="'+e.text()+'">'+e.text()+"</span>"),void t.each(i,function(t,e){y[e]=y[e].add(x[e])});R[""+(w-.02)]=x,R[""+(w-.01)]=x,R[""+w]=x,R[""+(w+.01)]=x,R[""+(w+.02)]=x}var E=t("<div/>",{"class":"imageEditor-sizeBox",css:{position:"absolute"}});E.hide(),n.append(E);var b=function(t){var e=t.width(),i=t.height(),a=parseFloat(x.x.val())||0,n=parseFloat(x.y.val())||0,s=parseFloat(x.width.val())||0,r=parseFloat(x.height.val())||0;return 0===s||0===r?(s=i*m,r=e/m,s>e?s=r*m:r=s/m,a=(e-s)/2,n=F?(i-r)/2:0):(a*=e,n*=i,s*=e,r*=i),{left:a,top:n,width:s,height:r}},z=t("<li/>",{"class":"imageEditor-sizeButton",click:function(){var e=t(this).closest("li");if(e.is(".imageEditor-sizeSelected"))return e.removeClass("imageEditor-sizeSelected"),O.hide(),C.hide(),X.hide(),Y.hide(),E.hide(),!1;e.closest("ul").find("li").removeClass("imageEditor-sizeSelected"),e.addClass("imageEditor-sizeSelected"),n.find(".imageEditor-sizeBox").hide();var i=b(r);return I(i),E.css(i),E.show(),E.find(".imageEditor-textOverlay").each(function(e){var i=t(this);i.trigger("resizeTextOverlayFont");var n=parseFloat(x.textWidths.val().split(a)[e+1])||0;if(0!==n){var s=parseFloat(x.textXs.val().split(a)[e+1])||0,r=parseFloat(x.textYs.val().split(a)[e+1])||0;i.css({left:100*s+"%",top:100*r+"%",width:100*n+"%"})}}),!1}});T.append(z);var k=function(){var e=t(document.body);e.append(p);var i=b(p);p.remove(),Pixastic.process(l,"crop",i,function(t){var e=z.find(".imageEditor-sizePreview");e.empty(),e.append(t)})},$=function(e){return function(i){var a=E.position(),n={left:a.left,top:a.top,width:E.width(),height:E.height(),pageX:i.pageX,pageY:i.pageY},s=r.width(),o=r.height();return t.drag(this,i,function(t){},function(t){var i=t.pageX-n.pageX,a=t.pageY-n.pageY,r=e(t,n,{x:i,y:a,constrainedX:Math.max(i,a*m),constrainedY:Math.max(a,i/m)});for(key in n)r[key]=r[key]||n[key];var d;r.moving?(r.left<0&&(r.left=0),r.top<0&&(r.top=0),d=r.left+r.width-s,d>0&&(r.left-=d),d=r.top+r.height-o,d>0&&(r.top-=d)):((r.width<10||r.height<10)&&(m>1?(r.width=10*m,r.height=10):(r.width=10,r.height=10/m)),r.left<0&&(r.width+=r.left,r.height=r.width/m,r.top-=r.left/m,r.left=0),r.top<0&&(r.height+=r.top,r.width=r.height*m,r.left-=r.top*m,r.top=0),d=r.left+r.width-s,d>0&&(r.width-=d,r.height=r.width/m),d=r.top+r.height-o,d>0&&(r.height-=d,r.width=r.height*m)),I(r),E.css(r),E.find(".imageEditor-textOverlay").trigger("resizeTextOverlayFont")},function(){var t=E.position(),e=E.width();E.height();x.x.val(t.left/s),x.y.val(t.top/o),x.width.val(e/s),x.height.val(e/m/o),k(),E.find(".imageEditor-textOverlay").trigger("resizeTextOverlayFont")}),!1}};E.mousedown($(function(t,e,i){return{moving:!0,left:e.left+i.x,top:e.top+i.y}})),E.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-topLeft",mousedown:$(function(t,e,i){return{left:e.left+i.constrainedX,top:e.top+i.constrainedY,width:e.width-i.constrainedX,height:e.height-i.constrainedY}})})),E.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-bottomRight",mousedown:$(function(t,e,i){return{width:e.width+i.constrainedX,height:e.height+i.constrainedY}})}));var S=t("<span/>",{"class":"imageEditor-sizeLabel",html:'<span title="'+e.text()+'">'+e.text()+"</span>"});x.$sizeLabel=S,z.append(S);var B=t("<div/>",{"class":"imageEditor-sizePreview",html:t("<img/>",{alt:e.text(),src:o,load:function(){k()}})});z.append(B);var L=0;S.after(t("<a/>",{"class":"imageEditor-addTextOverlay",text:"Add Text",click:function(e,i){++L;var r=t("<div/>",{"class":"imageEditor-textOverlay",css:{left:100*(x.textXs.val().split(a)[L]||.25)+"%",position:"absolute",top:100*(x.textYs.val().split(a)[L]||.25)+"%",width:100*(x.textWidths.val().split(a)[L]||.5)+"%","z-index":1}});E.append(r);var o=t("<div/>",{"class":"imageEditor-textOverlayLabel",text:"Text #"+L}),d=function(){if(E.is(":visible")){var e="";E.find(".imageEditor-textOverlay").each(function(){var i,n=t(this),s=t(n.find(".rte-container iframe")[0].contentDocument.body),r=t.data(this,"imageEditor-originalFontSize");!r&&s.is(".rte-loaded")&&(r=parseFloat(s.css("font-size")),t.data(this,"imageEditor-originalFontSize",r)),e+=a,r>0&&(i=1/g*r,e+=i,s.css("font-size",E.height()*i))}),x.textSizes.val(e)}};r.bind("resizeTextOverlayFont",d);var h=function(e){return function(i){d();var n=r.position(),s={left:n.left,top:n.top,width:r.width(),height:r.height(),pageX:i.pageX,pageY:i.pageY},o=E.width(),h=E.height();return i.dragImmediately=!0,t.drag(this,i,function(t){},function(t){var i=t.pageX-s.pageX,a=t.pageY-s.pageY,n=e(t,s,{x:i,y:a});for(key in s)n[key]=n[key]||s[key];n.left=n.left/o*100+"%",n.top=n.top/h*100+"%",n.width=n.width/o*100+"%",n.height="auto",r.css(n)},function(){var e="",i="",n="",s="";E.find(".imageEditor-textOverlay").each(function(){var r=t(this),d=r.position(),p=r.width();r.height();e+=a+r.find(".imageEditor-textOverlayInput").val(),i+=a+d.left/o,n+=a+d.top/h,s+=a+p/o}),x.texts.val(e),x.textXs.val(i),x.textYs.val(n),x.textWidths.val(s)}),!1}};o.mousedown(h(function(t,e,i){return{moving:!0,left:e.left+i.x,top:e.top+i.y}})),r.append(o);var p=t("<div/>",{"class":"imageEditor-textOverlayRemove",text:"Remove",click:function(){return r.remove(),!1}});r.append(p),r.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-left",mousedown:h(function(t,e,i){return{left:e.left+i.x,width:e.width-i.x}})})),r.append(t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-right",mousedown:h(function(t,e,i){return{left:e.left,width:e.width+i.x}})}));var l=t("<input/>",{"class":"imageEditor-textOverlayInput",type:"text",value:x.texts.val().split(a)[L]||""});r.append(l),l.rte({initImmediately:!0,useLineBreaks:!0}),n.before(r.find(".rte-toolbar-container")),i||l.focus();var f=5e3,c=function(){var e=t(r.find(".rte-container iframe")[0].contentDocument.body);e.is(".rte-loaded")?d():(f-=100,f>0&&setTimeout(c,100))};if(c(),s.submit(function(){var e="";E.find(".imageEditor-textOverlay").each(function(){e+=a+t(this).find(".imageEditor-textOverlayInput").val()}),x.texts.val(e)}),!i){var u=E.width(),v=E.height(),m="",w="",y="",b="";E.find(".imageEditor-textOverlay").each(function(){var e=t(this),i=e.position(),n=e.width();e.height();m+=a+e.find(".imageEditor-textOverlayInput").val(),w+=a+i.left/u,y+=a+i.top/v,b+=a+n/u}),x.texts.val(m),x.textXs.val(w),x.textYs.val(y),x.textWidths.val(b)}return!1}})),t.each(x.texts.val().split(a),function(t,e){t>0&&z.find(".imageEditor-addTextOverlay").trigger("click",!0)})}),S.before(T),S.hide();var B=T.find(".imageEditor-sizeButton");1==B.length&&B.click()}})});