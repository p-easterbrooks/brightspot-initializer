define(["jquery","bsp-utils"],function(e,t){var a,r=e();t.onDomInsert(document,".queryField",{insert:function(t){var i,n,s=e(t),o=s.find("input").val();e(window.document.body);r=r.add(s),a||(a=e("<div/>",{"class":"queryField_frames"}),e(window.document.body).append(a)),i=o?JSON.parse(o)["cms.ui.search"]:null,i=i?i:{limit:10};var l=s.closest(".inputLarge").attr("data-generic-arguments");i.types=l?l.split("\\s*,\\s*"):null,n=e("<div/>",{"class":"frame",html:e("<form/>",{method:"post",action:CONTEXT_PATH+"/queryField",html:[e("<input/>",{type:"hidden",name:"containerObjectId",value:s.closest("form").attr("data-content-id")}),e("<input/>",{type:"hidden",name:"search",value:i?JSON.stringify(i):""})]})}),e.data(s[0],"query-$frame",n),e.data(n[0],"query-$field",s)}}),setInterval(function(){function t(e){var t=e.closest(".repeatableForm, .repeatableInputs, .repeatableLayout, .repeatableObjectId, .repeatableText");return t.length>0&&!t.is(".plugin-repeatable")}r.filter(":visible").each(function(){var r=e(this);if(!t(r)){var i;e.each(r.parents().toArray().reverse(),function(t,a){var r=e(a),n=r.css("position");return""!==n&&"static"!==n?(i=r,!1):void 0});var n=e.data(r[0],"query-$frame"),s=r.offset();0===n.closest(".queryField_frames").length&&(a.append(n),a.trigger("create")),n.css({left:s.left,position:"absolute",top:s.top,"z-index":(i?parseInt(i.css("z-index"),10)||0:0)+1}),n.outerWidth(r.outerWidth()),r.outerHeight(n.outerHeight()),n.show()}}),r.filter(":not(:visible)").each(function(){var a=e(this);if(!t(a)){var r=e.data(a[0],"query-$frame");r&&r.closest(".queryField_frames").length>0&&r.hide()}}),e(".queryField_frames > .frame").each(function(){var a=e.data(this,"query-$field");t(a)||a&&a.is(":visible")||e(this).hide()})},100)});