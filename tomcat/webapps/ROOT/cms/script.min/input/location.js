define(["jquery","jquery.extra","input/leaflet"],function(o){o.plugin2("locationMap",{_create:function(n){var a=this,e=L.map(n,{scrollWheelZoom:!1});(new L.TileLayer.MapQuestOpenOSM).addTo(e);var t=o(n).find(".locationMapLatitude"),i=o(n).find(".locationMapLongitude"),r=o(n).find(".locationMapZoom"),c=o(t).val(),l=o(i).val(),d=o(r).val();c&&""!==c&&0!==c.length&&l&&""!==l&&0!==l.length||(c=39.8282,l=-98.5795,d=4),e.setView([c,l],d),e.on("zoomend",function(o){r.val(e.getZoom())});var u=L.marker([c,l],{draggable:!0}).addTo(e);u.on("dragend",function(o){a.updateLatLng(o.target,e,t,i,r)});var g=function(o,n){e.hasLayer(u)||u.addTo(e),u.setLatLng([o,n]),a.updateLatLng(u,e,t,i,r)};new L.Control.GeoSearch({zoomLevel:16,showMarker:!1,provider:new L.GeoSearch.Provider.OpenStreetMap}).addTo(e),e.on("geosearch_foundlocations",function(o){o.Locations&&o.Locations.length>0&&g(o.Locations[0].Y,o.Locations[0].X)}),o("#leaflet-control-geosearch-qry").keypress(function(o){13===o.which&&o.preventDefault()}),L.control.locate({drawCircle:!1,icon:"icon icon-map-marker",iconLoading:"icon icon-rss",strings:{title:"Set marker to your current location",popup:"<b>Current location</b><br/>(within {distance} {unit})"}}).addTo(e),e.on("locationfound",function(o){g(o.latitude,o.longitude)})},updateLatLng:function(o,n,a,e,t){var i=o.getLatLng();a.val(i.lat),e.val(i.lng),t.val(n.getZoom())}})});