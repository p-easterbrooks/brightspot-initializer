define(["jquery","bsp-utils"],function(a,n){n.onDomInsert(document,".dashboardCell",{insert:function(n){var e,s,o,t,d,l,r,i=a(n);e=a("<span/>",{"class":"dashboardCollapse",click:function(){i.toggleClass("dashboardCell-collapse"),o()}}),s=a("<span/>",{"class":"dashboardMoveContainer",click:function(){a(this).toggleClass("dashboardMoveContainer-open")}}),o=function(){var n,e=i.closest(".dashboard"),s=[],o=[],t=e.attr("data-settings-prefix");"undefined"==typeof t&&(t=""),e.find(".dashboardColumn:empty").remove(),n=e.find(".dashboardColumn"),e.attr("data-columns",n.length),n.each(function(){var n=s[s.length]=[];a(this).find(".dashboardCell").each(function(){var e=a(this),s=e.attr("data-widget");n[n.length]=s,e.hasClass("dashboardCell-collapse")&&(o[o.length]=s)})}),a.ajax({type:"post",url:CONTEXT_PATH+"/misc/updateUserSettings",data:{action:"dashboardWidgets-position",settingsPrefix:t,widgets:JSON.stringify(s),widgetsCollapse:JSON.stringify(o)}})},t=a("<span/>",{"class":"dashboardMoveUp",click:function(){i.prev().before(i),o()}}),d=a("<span/>",{"class":"dashboardMoveDown",click:function(){i.next().after(i),o()}}),l=a("<span/>",{"class":"dashboardMoveLeft",click:function(){var n=i.closest(".dashboardColumn");$prevColumn=n.prev(),0===$prevColumn.length&&($prevColumn=a("<div/>",{"class":"dashboardColumn"}),n.before($prevColumn)),$prevColumn.prepend(i),o()}}),r=a("<span/>",{"class":"dashboardMoveRight",click:function(){var n=i.closest(".dashboardColumn");$nextColumn=n.next(),0===$nextColumn.length&&($nextColumn=a("<div/>",{"class":"dashboardColumn"}),n.after($nextColumn)),$nextColumn.prepend(i),o()}}),s.append(t),s.append(d),s.append(l),s.append(r),i.append(e),i.append(s)}})});