define(["jquery","bsp-utils"],function(e,t){t.onDomInsert(document,".infiniteScroll",{insert:function(r){function i(){var e=c.find(l.itemSelector);if(e){var t=e.first();return s.outerWidth()*(s.outerHeight()+s.scrollTop()+l.scrollBuffer)>=t.outerWidth()*t.outerHeight()*e.size()}return!1}function n(){i()&&l.state.hasLoadedAllItems!==!0&&"pending"!==l.state.activePromise.state()&&o()}function o(){var t=f.find(l.nextSelector);t&&(l.state.activePromise=e.ajax({cache:!1,type:"get",url:t.attr("href")}),l.state.activePromise.done(function(r){var i=e(r),o=i.find(l.itemsContainerSelector).children(),a=i.find(l.navSelector).find(l.nextSelector);(0==o.size()||0==a.size())&&(l.state.hasLoadedAllItems=!0),c.append(o),t.attr("href",a.attr("href")),n()}))}var a={navSelector:".searchResult-pagination",nextSelector:"li.next a",previousSelector:"li.prev a",itemsContainerSelector:".searchResult-images",itemSelector:"figure",scrollBuffer:100,prefill:!0},l=e.extend({},a,{state:{activePromise:(new e.Deferred).resolve()}}),s=e(r),c=s.find(l.itemsContainerSelector),f=s.find(l.navSelector);l.prefill&&n(),s.scroll(t.throttle(100,n))}})});