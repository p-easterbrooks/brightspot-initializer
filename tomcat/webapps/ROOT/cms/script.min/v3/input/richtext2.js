define(["jquery","v3/input/richtextCodeMirror","v3/plugin/popup","jquery.extra","jquery.handsontable.full"],function(e,t){var n,a;n=window.CONTEXT_PATH||"";var o=!1;if(a={styles:{bold:{className:"rte2-style-bold",element:"b",keymap:["Ctrl-B","Cmd-B"]},italic:{className:"rte2-style-italic",element:"i",keymap:["Ctrl-I","Cmd-I"]},underline:{className:"rte2-style-underline",element:"u",keymap:["Ctrl-U","Cmd-U"]},strikethrough:{className:"rte2-style-strikethrough",element:"strike"},superscript:{className:"rte2-style-superscript",element:"sup",clear:["subscript"]},subscript:{className:"rte2-style-subscript",element:"sub",clear:["superscript"]},comment:{className:"rte2-style-comment",element:"span",elementAttr:{"class":"rte rte-comment"},showFinal:!1,internal:!0},link:{className:"rte2-style-link",element:"a",elementAttrAny:!0,singleLine:!0,onClick:function(e,t){var n;n=this,e&&(e.preventDefault(),e.stopPropagation()),setTimeout(function(){n.linkEdit(t.attributes).done(function(e){e.remove||""===e.href||"http://"===e.href?t.clear():t.attributes=e}).fail(function(){t.attributes||t.clear()})},100)}},ol:{className:"rte2-style-ol",line:!0,element:"li",elementContainer:"ol",clear:["ul","alignLeft","alignCenter","alignRight"]},ul:{className:"rte2-style-ul",line:!0,element:"li",elementContainer:"ul",clear:["ol","alignLeft","alignCenter","alignRight"]},alignLeft:{className:"rte2-style-align-left",line:!0,element:"div",elementAttr:{"class":"cms-textAlign-left"},clear:["alignCenter","alignRight","ol","ul"]},alignCenter:{className:"rte2-style-align-center",line:!0,element:"div",elementAttr:{"class":"cms-textAlign-center"},clear:["alignLeft","alignRight","ol","ul"]},alignRight:{className:"rte2-style-align-right",line:!0,element:"div",elementAttr:{"class":"cms-textAlign-right"},clear:["alignLeft","alignCenter","ol","ul"]}},clipboardSanitizeRules:{"b:not([id^=docs-internal-guid])":"bold",strong:"bold",i:"italic",em:"italic",'span[style*="font-style:italic"]':"italic",'span[style*="font-weight:700"]':"bold",'span[style*="font-weight:bold"]':"bold",'span[style*="font-weight: bold"]':"bold",'span[style*="text-decoration:underline"]':"underline",'span[style*="vertical-align:super"]':"superscript",'span[style*="vertical-align:sub"]':"subscript",'li[style*="list-style-type:disc"] > p':"ul",'li[style*="list-style-type:decimal"] > p':"ol",'p[style*="text-align: right"]':"alignRight",'p[style*="text-align: center"]':"alignCenter",'p[style*="text-align:right"]':"alignRight",'p[style*="text-align:center"]':"alignCenter",p:"linebreak"},toolbarConfig:[{style:"bold",text:"B",className:"rte2-toolbar-bold",tooltip:"Bold"},{style:"italic",text:"I",className:"rte2-toolbar-italic",tooltip:"Italic"},{style:"underline",text:"U",className:"rte2-toolbar-underline",tooltip:"Underline"},{style:"strikethrough",text:"S",className:"rte2-toolbar-strikethrough",tooltip:"Strikethrough"},{style:"superscript",text:"Super",className:"rte2-toolbar-superscript",tooltip:"Superscript"},{style:"subscript",text:"Sub",className:"rte2-toolbar-subscript",tooltip:"Subscript"},{style:"link",text:"Link",className:"rte2-toolbar-link",tooltip:"Link"},{style:"html",text:"HTML",className:"rte2-toolbar-html",tooltip:"Raw HTML"},{action:"clear",text:"Clear",className:"rte2-toolbar-clear",tooltip:"Clear Formatting"},{separator:!0,inline:!1},{style:"ul",text:"&bull;",className:"rte2-toolbar-ul",tooltip:"Bulleted List",inline:!1},{style:"ol",text:"1.",className:"rte2-toolbar-ol",tooltip:"Numbered List",inline:!1},{separator:!0,inline:!1},{style:"alignLeft",text:"Left",className:"rte2-toolbar-align-left",activeIfUnset:["alignCenter","alignRight","ol","ul"],tooltip:"Left Align Text",inline:!1},{style:"alignCenter",text:"Center",className:"rte2-toolbar-align-center",tooltip:"Center Align Text",inline:!1},{style:"alignRight",text:"Right",className:"rte2-toolbar-align-right",tooltip:"Right Align Text",inline:!1},{custom:!0},{separator:!0,inline:!1},{action:"enhancement",text:"Enhancement",className:"rte2-toolbar-enhancement",tooltip:"Add Block Enhancement",inline:!1},{action:"marker",text:"Marker",className:"rte2-toolbar-marker",tooltip:"Add Marker",inline:!1},{action:"table",text:"Table",className:"rte2-toolbar-noicon",tooltip:"Add Table",inline:!1},{separator:!0},{action:"trackChangesToggle",text:"Track Changes",className:"rte2-toolbar-track-changes",tooltip:"Toggle Track Changes"},{action:"trackChangesAccept",text:"Accept",className:"rte2-toolbar-track-changes-accept",tooltip:"Accept Change"},{action:"trackChangesReject",text:"Reject",className:"rte2-toolbar-track-changes-reject",tooltip:"Reject Change"},{action:"trackChangesShowFinalToggle",text:"Show Final",className:"rte2-toolbar-track-changes-show-final",tooltip:"Toggle Preview"},{separator:!0},{style:"comment",text:"Add Comment",className:"rte2-toolbar-comment",tooltip:"Add Comment"},{action:"cleartext",text:"Remove Comment",className:"rte2-toolbar-comment-remove",tooltip:"Remove Comment",cleartextStyle:"comment"},{action:"collapse",text:"Collapse All Comments",className:"rte2-toolbar-comment-collapse",collapseStyle:"comment",tooltip:"Collapse All Comments"},{separator:!0},{action:"fullscreen",text:"Fullscreen",className:"rte2-toolbar-fullscreen",tooltip:"Toggle Fullscreen Editing"},{action:"modeToggle",text:"HTML",className:"rte2-toolbar-noicon",tooltip:"Toggle HTML Mode"}],toolbarLocation:void 0,doOnSubmit:!0,inline:!1,init:function(t,n){var a;a=this,n&&e.extend(!0,a,n),a.$el=e(t),a.$el.data("rte2",a),a.initStyles(),a.initRte(),a.toolbarInit(),a.linkInit(),a.enhancementInit(),a.inlineEnhancementInit(),a.trackChangesInit(),a.placeholderInit(),a.modeInit(),setTimeout(function(){a.rte.refresh()},1)},initStyles:function(){var t;t=this,t.initStylesCustom(),e.each(t.styles,function(n,a){a.onClick&&(a.onClick=e.proxy(a.onClick,t))})},initStylesCustom:function(){var t,n;n=this,window.CSS_CLASS_GROUPS&&(n.loadCMSStyles(),t={},e.each(window.CSS_CLASS_GROUPS,function(){var n,a;n=this,a="cms-"+n.internalName,e.each(n.cssClasses,function(){var e,n,o;e=this,n=a+"-"+e.internalName,o={line:!1,className:n,element:(e.tag||"span").toLowerCase(),elementAttr:{"class":n}},t[n]=o})}),n.styles=e.extend(!0,{},t,n.styles))},initRte:function(){var n,a;a=this,n=a.$el.val()||"",a.rte=Object.create(t),a.rte.styles=e.extend(!0,{},a.rte.styles,a.styles),a.rte.clipboardSanitizeRules=e.extend(!0,{},a.rte.clipboardSanitizeRules,a.clipboardSanitizeRules),a.$container=e("<div/>",{"class":"rte2-wrapper"}).insertAfter(a.$el),a.$container.data("rte2",a),a.$editor=e("<div/>",{"class":"rte2-codemirror"}).appendTo(a.$container),a.$el.appendTo(a.$container),a.$editor.on("rteFocus",function(){return a.$el.trigger("rteFocus",[a]),!1}),a.$editor.on("rteBlur",function(){return a.$el.trigger("rteBlur",[a]),!1}),a.$editor.on("rteChange",function(){return a.$el.trigger("rteChange",[a]),!1}),a.$el.hide(),a.doOnSubmit&&a.$el.closest("form").on("submit",function(){"rich"===a.rte.modeGet()&&(a.trackChangesSave(),a.$el.val(a.toHTML()))}),a.rte.init(a.$editor),a.rte.readOnlySet(a.$el.closest(".inputContainer-readOnly").length),a.rte.enhancementFromHTML=function(e,t){a.enhancementFromHTML(e,t)},a.rte.fromHTML(n),a.rte.historyClear(),a.previewInit()},loadCMSStyles:function(){var t;t=this,window.CSS_CLASS_GROUPS&&!o&&(o=!0,e.ajax({url:n+"/style/v3/rte2-cms-styles.jsp",cache:!1,async:!1,success:function(t){e("<style>"+t+"</style>").appendTo("head")}}))},fullscreenToggle:function(){var t;t=this,e(".toolBroadcast").toggle(),e(".toolHeader").toggle(),e("body").toggleClass("rte-fullscreen"),t.$container.toggleClass("rte-fullscreen"),t.toolbarHoist(),t.rte.refresh()},fullscreenIsActive:function(){return e("body").hasClass("rte-fullscreen")},modeInit:function(){var e=this;e.$container.on("rteModeChange",function(t,n){"plain"===n?e.modeSetPlain():e.modeSetRich()})},modeSetPlain:function(){var t=this;t.$el.val(t.rte.toHTML()),t.$el.show(),e(window).resize()},modeSetRich:function(){var e=this;e.$el.hide(),e.rte.fromHTML(e.$el.val())},trackChangesInit:function(){var e;e=this,e.trackChangesRestore()},trackChangesSave:function(){var e,t,n;t=this,e=t.trackChangesGetName(),e&&(window.sessionStorage.removeItem(e),n=t.rte.trackIsOn(),n&&window.sessionStorage.setItem(e,"1"))},trackChangesRestore:function(){var e,t;t=this,e=t.trackChangesGetName(),e&&window.sessionStorage.getItem(e)&&(t.rte.trackSet(!0),t.toolbarUpdate())},trackChangesGetName:function(){var e,t;return t=this,e=t.$el.closest(".inputContainer").attr("data-name")||"",e&&(e="bsp.rte.changesTracking."+e),e},toolbarInit:function(){function t(a,o){var r;e.each(a,function(e,a){n.inline&&a.inline===!1||(a.separator?n.toolbarAddSeparator(o):a.submenu?(r=n.toolbarAddSubmenu(a,o),t(a.submenu,r)):a.custom?n.toolbarInitCustom(o):n.toolbarAddButton(a,o))})}var n,a;n=this,a=e("<ul/>",{"class":"rte2-toolbar"}),n.toolbarLocation?a.appendTo(n.toolbarLocation):a.insertBefore(n.$editor),n.$toolbar=a,n.rte.readOnlyGet()&&n.$toolbar.hide(),t(n.toolbarConfig,a),n.$container.on("rteCursorActivity",function(){n.toolbarUpdate()}),n.toolbarUpdate(),e(window).bind("rteHoistToolbar",function(){n.toolbarHoist()})},toolbarInitCustom:function(t){var n=this;window.CSS_CLASS_GROUPS&&0!==window.CSS_CLASS_GROUPS.length&&(n.toolbarAddSeparator(t),e.each(window.CSS_CLASS_GROUPS,function(){var a,o,r;a=this,o="cms-"+a.internalName,r=t,a.dropDown&&(r=n.toolbarAddSubmenu({text:a.displayName},t)),e.each(a.cssClasses,function(){var e,t,a;e=this,t=o+"-"+e.internalName,a={style:t,text:e.displayName,className:"rte2-toolbar-custom"},n.toolbarAddButton(a,r)})}))},toolbarAddSubmenu:function(t,n){var a,o=this,r=n||o.$toolbar;return a=e('<li class="rte2-toolbar-submenu '+(t.className||"")+'"><span></span><ul></ul></li>'),a.find("span").html(t.text),a.appendTo(r),a.find("ul")},toolbarAddButton:function(t,n){var a,o=this,r=n||o.$toolbar;a=e("<a/>",{href:"#","class":t.className||"",html:t.text||"",title:t.tooltip||"",data:{toolbarConfig:t}}),a.on("click",function(e){e.preventDefault(),o.toolbarHandleClick(t,e)}),e("<li/>").append(a).appendTo(r)},toolbarAddSeparator:function(t){var n=this,a=t||n.$toolbar;e("<li/>",{"class":"rte2-toolbar-separator"}).appendTo(a)},toolbarHandleClick:function(t,n){var a,o,r,l,i;if(r=this,o=r.rte,l=r.rte.styles[t.style]||{},t.action)switch(t.action){case"caseToggleSmart":o.caseToggleSmart();break;case"caseToLower":o.caseToLower();break;case"caseToUpper":o.caseToUpper();break;case"clear":o.removeStyles();break;case"cleartext":t.cleartextStyle&&o.inlineRemoveStyledText(t.cleartextStyle);break;case"collapse":t.collapseStyle&&o.inlineToggleCollapse(t.collapseStyle,o.getRangeAll());break;case"enhancement":n.stopPropagation(),n.preventDefault(),o.moveToNonBlank(),r.enhancementCreate();break;case"table":r.tableCreate();break;case"fullscreen":r.fullscreenToggle();break;case"insert":t.value&&(i=e("<div>").html(t.value).text(),o.insert(i));break;case"marker":n.stopPropagation(),n.preventDefault(),r.enhancementCreate({marker:!0});break;case"trackChangesToggle":o.trackToggle();break;case"trackChangesAccept":o.trackAcceptRange();break;case"trackChangesReject":o.trackRejectRange();break;case"trackChangesShowFinalToggle":o.trackDisplayToggle();break;case"find":return o.focus(),void o.find();case"replace":return o.focus(),void o.replace();case"modeToggle":o.modeToggle()}else l.enhancementType?(n.stopPropagation(),n.preventDefault(),r.inlineEnhancementCreate(n,t.style)):t.style&&(l.onClick?(a=o.setStyle(t.style),a&&l.onClick(n,a)):a=o.toggleStyle(t.style));o.inlineCombineAdjacentMarks(),r.toolbarUpdate(),r.focus()},toolbarUpdate:function(){var t,n,a,o,r;o=this,a=o.rte,n=a.modeGet(),o.$toolbar.children("li").toggle("rich"===n),t=o.$toolbar.find("a"),t.removeClass("active"),o.$toolbar.find(".rte2-toolbar-submenu").removeClass("active"),r=e.extend({},a.inlineGetStyles(),a.blockGetStyles()),t.each(function(){var t,l,i;if(l=e(this),t=l.data("toolbarConfig"),t.action&&"enhancementInline"!==t.action)switch(t.action){case"trackChangesToggle":l.toggleClass("active",a.trackIsOn());break;case"trackChangesAccept":case"trackChangesReject":(r.hasOwnProperty("trackInsert")||r.hasOwnProperty("trackDelete"))&&l.addClass("active");break;case"trackChangesShowFinalToggle":l.toggleClass("active",!a.trackDisplayGet());break;case"fullscreen":l.toggleClass("active",o.fullscreenIsActive()),l.parent().show();break;case"modeToggle":l.toggleClass("active","plain"===n),l.parent().show()}else t.style&&r[t.style]===!0&&(l.addClass("active"),l.closest(".rte2-toolbar-submenu").addClass("active")),t.activeIfUnset&&(i=!0,e.each(t.activeIfUnset,function(e,t){r.hasOwnProperty(t)&&(i=!1)}),i&&l.addClass("active"))})},toolbarToggle:function(){var e;e=this,e.$toolbar.toggle()},toolbarShow:function(){var e;e=this,e.$toolbar.show()},toolbarHide:function(){var e;e=this,e.$toolbar.hide()},toolbarHoist:function(){var t,n,a,o,r=this,l=e(window),i=e(".toolHeader"),c=0,s=l.scrollTop()+c,m=window.requestAnimationFrame,d=r.$container,h=r.$toolbar;d.is(":visible")&&(i.is(":visible")&&(c=i.offset().top+i.outerHeight()-("fixed"===i.css("position")?l.scrollTop():0)),h=r.$toolbar,t=d.offset().top,n=h.outerHeight(),t-=n,d.outerHeight()<3*n||t>s?h.hasClass("rte2-toolbar-fixed")&&m(function(){d.css("padding-top",0),h.removeClass("rte2-toolbar-fixed"),h.attr("style",r._toolbarOldStyle),r._toolbarOldStyle=null}):(r._toolbarOldStyle=r._toolbarOldStyle||h.attr("style")||" ",m(function(){d.css("padding-top",n)}),s<t+d.height()?(a=h.offset().left,o=h.width(),m(function(){h.addClass("rte2-toolbar-fixed"),h.css({left:a,position:"fixed",top:c,width:o})})):m(function(){h.css({top:-1e4,position:"fixed"})})))},linkInit:function(){var t;t=this,t.$linkDialog=e('<div><h2>Link</h2><div class="rte2-dialogLine"><input type="text" class="rte2-dialogLinkHref"><input type="hidden" class="rte2-dialogLinkId"><a class="rte2-dialogLinkContent" target="linkById" href="'+n+'/content/linkById.jsp?p=true">Content</a></div><div class="rte2-dialogLine"><select class="rte2-dialogLinkTarget"><option value="">Same Window</option><option value="_blank">New Window</option></select><select class="rte2-dialogLinkRel"><option value="">Relation</option><option value="nofollow">nofollow</option></select></div><a class="rte2-dialogLinkSave">Save</a><a class="rte2-dialogLinkOpen" target="_blank">Open</a><a class="rte2-dialogLinkUnlink">Unlink</a></div>').on("click",".rte2-dialogLinkSave",function(){return t.linkSave(),t.$linkDialog.popup("close"),!1}).on("click",".rte2-dialogLinkUnlink",function(){return t.linkUnlink(),t.$linkDialog.popup("close"),!1}).on("input",".rte2-dialogLinkHref",function(n){t.$linkDialog.find(".rte2-dialogLinkOpen").attr("href",e(n.target).val())}).on("keydown",".rte2-dialogLinkHref",function(e){return 13===e.which?(t.linkSave(),t.$linkDialog.popup("close"),!1):void 0}).appendTo(document.body).popup().popup("close").popup("container").on("close",function(){t.linkClose()})},linkEdit:function(t){var n,a,o,r;return r=this,t=t||{},a=r.$linkDialog,n=e.Deferred(),a.popup("open"),o=a.find(".rte2-dialogLinkHref"),o.val(t.href||"http://"),a.find(".rte2-dialogLinkId").val(t.cmsId||""),a.find(".rte2-dialogLinkTarget").val(t.target||""),a.find(".rte2-dialogLinkRel").val(t.rel||""),a.find(".rte2-dialogLinkOpen").attr("href",o.val()),o.focus(),r.linkDeferred=n,n.promise()},linkSave:function(){var e,t,n,a,o,r,l;n=this,t=n.$linkDialog,a=t.find(".rte2-dialogLinkHref").val()||"",r=t.find(".rte2-dialogLinkTarget").val()||"",o=t.find(".rte2-dialogLinkRel").val()||"",l=t.find(".rte2-dialogLinkId").val()||"",e={},e.href=a,r&&(e.target=t.find(".rte2-dialogLinkTarget").val()||""),o&&(e.rel=t.find(".rte2-dialogLinkRel").val()||""),l&&(e["data-cms-id"]=l,e["data-cms-href"]=a),n.linkDeferred.resolve(e)},linkUnlink:function(){var e;e=this,e.linkDeferred.resolve({remove:!0})},linkClose:function(){var e;e=this,e.linkDeferred&&e.linkDeferred.reject()},enhancementInit:function(){var t;t=this,t.enhancementGetTargetCounter=0,e(document.body).on("click","[data-enhancement]",function(n){var a,o,r,l;return l=e(this),r=l.popup("source"),t.$container.find(r).length?(o=t.enhancementGetWrapper(r),a=l.data("enhancement"),t.enhancementSetReference(o,a),l.popup("close"),t.focus(),n.preventDefault(),n.stopImmediatePropagation(),!1):void 0}),e(document.body).on("close",'.popup[name^="contentEnhancement-"]',function(){var n,a,o;o=e(this),a=o.popup("source"),t.$container.find(a).length&&(n=t.enhancementGetWrapper(a),t.enhancementUpdate(n))})},enhancementCreate:function(t,n){var a,o,r;r=this,t=t||{},a=e("<div/>",{"class":"rte2-enhancement"}),r.rte.readOnlyGet()||a.append(r.enhancementToolbarCreate(t)),t.marker&&a.addClass("rte2-marker"),a.on("click",function(){r.enhancementSetCursor(this),r.focus()}),e("<div/>",{"class":"rte2-enhancement-label"}).appendTo(a),o=r.rte.enhancementAdd(a[0],n,{block:!0,toHTML:function(){return r.enhancementToHTML(a)}}),t.reference?(r.enhancementSetReference(a,t.reference),t.alignment&&r.enhancementSetPosition(a,t.alignment),r.enhancementUpdate(a)):r.enhancementChange(a)},enhancementUpdate:function(t){var n,a,o,r,l,i,c,s;return s=this,r=s.enhancementGetWrapper(t),n=r.find(".rte2-enhancement-label"),i=s.enhancementGetReference(r),l=s.enhancementIsMarker(r)?"Empty Marker":"Empty Enhancement",i.record?(n.empty(),i.preview?e("<figure/>",{html:[e("<img/>",{src:i.preview,title:i.label||""}),e("<figcaption/>",{text:i.label||""})]}).appendTo(n):n.text(i.label||l),s.enhancementDisplaySize(t),i.record&&i.record._ref&&(c=r.find(".rte2-enhancement-toolbar-change"),c.text("Change"),a=r.find(".rte2-enhancement-toolbar-edit"),o=a.attr("href")||"",o=e.addQueryParameters(o,"id",i.record._ref,"reference",JSON.stringify(i)),a.attr("href",o)),void s.rte.triggerChange()):void s.enhancementRemoveCompletely(r)},enhancementToolbarCreate:function(t){var a,o,r,l,i,c,s;return l=this,t=t||{},s=e("<ul/>",{"class":"rte2-enhancement-toolbar"}),l.enhancementToolbarAddButton({text:"Up",tooltip:"Move Up",className:"rte2-enhancement-toolbar-up",onClick:function(){l.enhancementMove(s,-1)}},s),l.enhancementToolbarAddButton({text:"Down",tooltip:"Move Down",className:"rte2-enhancement-toolbar-down",onClick:function(){l.enhancementMove(s,1)}},s),l.enhancementToolbarAddSeparator(s),l.enhancementToolbarAddButton({text:"Left",tooltip:"Position Left",className:"rte2-enhancement-toolbar-left",onClick:function(){l.enhancementSetPosition(s,"left")}},s),l.enhancementToolbarAddButton({text:"Full",tooltip:"Position Full Line",className:"rte2-enhancement-toolbar-full",onClick:function(){l.enhancementSetPosition(s,"full")}},s),l.enhancementToolbarAddButton({text:"Right",tooltip:"Position Right",className:"rte2-enhancement-toolbar-right",onClick:function(){l.enhancementSetPosition(s,"right")}},s),i=l.enhancementGetSizes(),i&&(l.enhancementToolbarAddSeparator(s),c=l.enhancementToolbarAddSubmenu({text:"Image Size",className:"rte2-enhancement-toolbar-sizes"},s),l.enhancementToolbarAddButton({text:"None",className:"rte2-enhancement-toolbar-size",onClick:function(){l.enhancementSetSize(s,"")}},c),e.each(i,function(e,t){l.enhancementToolbarAddButton({text:t,className:"rte2-enhancement-toolbar-size",onClick:function(){l.enhancementSetSize(s,e)}},c)})),l.enhancementToolbarAddSeparator(s),a=l.$el.closest("form").attr("action")||"",o=(/id=([^&]+)/.exec(a)||[])[1]||"",r=(/typeId=([^&]+)/.exec(a)||[])[1]||"",l.enhancementToolbarAddButton({text:"Select",tooltip:"",className:"rte2-enhancement-toolbar-change",href:n+(t.marker?"/content/marker.jsp":"/enhancementSelect")+"?pt="+encodeURIComponent(o)+"&py="+encodeURIComponent(r),target:l.enhancementGetTarget()},s),t.marker||l.enhancementToolbarAddButton({href:n+"/content/enhancement.jsp",target:l.enhancementGetTarget(),text:"Edit",className:"rte2-enhancement-toolbar-edit"},s),l.enhancementToolbarAddButton({text:"Remove",className:"rte2-enhancement-toolbar-remove",onClick:function(){l.enhancementRemove(s)}},s),l.enhancementToolbarAddButton({text:"Restore",className:"rte2-enhancement-toolbar-restore",onClick:function(){l.enhancementRestore(s,!1)}},s),l.enhancementToolbarAddButton({text:"Remove Completely",className:"rte2-enhancement-toolbar-remove-completely",onClick:function(){l.enhancementRemoveCompletely(s)}},s),s},enhancementToolbarAddSubmenu:function(t,n){var a;return a=e('<li class="rte2-toolbar-submenu"><span></span><ul></ul></li>'),a.find("span").html(t.text),a.appendTo(n),a.find("ul")},enhancementToolbarAddButton:function(t,n){var a;a=e("<a/>",{href:t.href||"#",target:t.target||"","class":t.className||"",html:t.text||"",title:t.tooltip||""}),void 0!==t["data-enhancement-size"]&&a.attr("data-enhancement-size",t["data-enhancement-size"]),t.onClick&&a.on("click",function(e){return e.preventDefault(),t.onClick.call(this,e),!1}),e("<li/>").append(a).appendTo(n)},enhancementToolbarAddSeparator:function(t){e("<li/>",{"class":"rte2-toolbar-separator",html:"&nbsp;"}).appendTo(t)},enhancementChange:function(e){var t,n=this;t=n.enhancementGetWrapper(e),t.find(".rte2-enhancement-toolbar-change").trigger("click")},enhancementRemove:function(e){var t,n;n=this,t=n.enhancementGetWrapper(e),t.addClass("toBeRemoved"),n.rte.triggerChange()},enhancementRemoveCompletely:function(e){var t,n;n=this,t=n.enhancementGetMark(e),t&&n.rte.enhancementRemove(t),n.rte.triggerChange()},enhancementRestore:function(e){var t,n;n=this,t=n.enhancementGetWrapper(e),t.removeClass("toBeRemoved"),n.rte.triggerChange()},enhancementIsToBeRemoved:function(e){var t,n;return n=this,t=n.enhancementGetWrapper(e),t.hasClass("toBeRemoved")},enhancementMove:function(t,n){var a,o,r,l,i,c;r=this,o=r.enhancementGetMark(t),o&&(1===n||-1===n)&&(a=r.enhancementGetWrapper(t),i=a.offset().top,o=r.rte.enhancementMove(o,n),l=a.offset().top,c=e(window).scrollTop(),e(window).scrollTop(c+l-i))},enhancementSetCursor:function(e){var t,n,a;a=this,n=a.enhancementGetMark(e),n&&(t=a.rte.enhancementGetLineNumber(n),a.rte.setCursor(t,0))},enhancementSetPosition:function(e,t){var n,a,o,r;switch(r=this,o=r.rte,n=r.enhancementGetWrapper(e),a=r.enhancementGetMark(n),n.removeClass("rte2-style-enhancement-right rte2-style-enhancement-left rte2-style-enhancement-full"),t){case"left":a=o.enhancementSetInline(a),n.addClass("rte2-style-enhancement-left");break;case"right":a=o.enhancementSetInline(a),n.addClass("rte2-style-enhancement-right");break;default:a=o.enhancementSetBlock(a),n.addClass("rte2-style-enhancement-full")}o.refresh()},enhancementGetPosition:function(e){var t,n,a;return a=this,t=a.enhancementGetWrapper(e),t.hasClass("rte2-style-enhancement-left")?n="left":t.hasClass("rte2-style-enhancement-right")&&(n="right"),n||""},enhancementGetWrapper:function(t){var n;return n=this,e(t).closest(".rte2-enhancement")},enhancementGetMark:function(e){var t;return t=this,e=t.enhancementGetWrapper(e),t.rte.enhancementGetMark(e)},enhancementSetMark:function(e,t){var n;n=this,n.enhancementGetWrapper(e).data("mark",t)},enhancementGetTarget:function(){var e;return e=this,"contentEnhancement-"+e.enhancementGetTargetCounter++},enhancementIsMarker:function(e){var t=this,n=t.enhancementGetWrapper(e);return n.hasClass("rte2-marker")},enhancementGetSizes:function(){var t,n,a,o,r;return n=this,a={},r=window.STANDARD_IMAGE_SIZES||[],o=n.$el.closest(".inputContainer").attr("data-standard-image-sizes")||"",o=" "+o+" ",e.each(r,function(){var e=this;o.indexOf(" "+e.internalName+" ")>-1&&(t=!0,a[e.internalName]=e.displayName)}),t?a:void 0},enhancementSetSize:function(e,t){var n,a,o,r;o=this,n=o.enhancementGetWrapper(e),a=o.enhancementGetReference(e),r=o.enhancementGetSizes()||{},r[t]?a.imageSize=t:delete a.imageSize,o.enhancementSetReference(e,a),o.enhancementDisplaySize(e)},enhancementDisplaySize:function(t){var n,a,o,r,l,i,c;r=this,n=r.enhancementGetWrapper(t),a=n.find(".rte2-enhancement-label"),o=r.enhancementGetReference(t),l=r.enhancementGetSizes(t)||{},i=l[o.imageSize],c=a.find(".rte2-enhancement-size"),o.imageSize&&i?(c.length||(c=e("<div/>",{"class":"rte2-enhancement-size"}).appendTo(a)),c.text(i)):c.remove()},enhancementGetReference:function(e){var t,n,a;return a=this,t=a.enhancementGetWrapper(e),n=t.data("reference")||{}},enhancementSetReference:function(e,t){var n,a;a=this,n=a.enhancementGetWrapper(e),n.data("reference",t)},enhancementToHTML:function(t){var n,a,o,r,l,i,c,s;return s=this,o=s.enhancementGetWrapper(t),c=s.enhancementIsMarker(o),s.enhancementIsToBeRemoved(o)?"":(a=s.enhancementGetReference(o),a.record&&(i=a.record._ref),delete a.alignment,n=s.enhancementGetPosition(t),n&&(a.alignment=n),i&&(l=e("<button/>",{"class":"enhancement","data-id":i,"data-reference":JSON.stringify(a),text:a.label||""}),c&&l.addClass("marker"),a.preview&&l.attr("data-preview",a.preview),n&&l.attr("data-alignment",n),r=l[0].outerHTML),r||"")},enhancementFromHTML:function(e,t){var n=this,a={};if(e.is("table"))n.tableCreate(e,t);else{try{a.reference=JSON.parse(e.attr("data-reference")||"")||{}}catch(o){a.reference={}}a.marker=e.hasClass("marker"),a.id=e.attr("data-id"),a.alignment=e.attr("data-alignment"),a.preview=e.attr("data-preview"),a.text=e.text(),n.enhancementCreate(a,t)}},inlineEnhancementInit:function(){var t;t=this,e.each(t.rte.styles,function(e,n){n.enhancementType&&!n.onClick&&(n.onClick=function(e,n){t.inlineEnhancementHandleClick(e,n)})})},inlineEnhancementCreate:function(e,t){var n,a,o;a=this,o=a.rte.styles[t]||{},n=a.rte.setStyle(t),n&&a.inlineEnhancementHandleClick(e,n)},inlineEnhancementHandleClick:function(t,n){var a,o,r,l,i,c;i=this,c=i.rte.classes[n.className]||{},c.enhancementType&&(t&&(t.preventDefault(),t.stopPropagation()),a=e.addQueryParameters(window.CONTEXT_PATH+"/content/enhancement.jsp","typeId",c.enhancementType,"attributes",JSON.stringify(n.attributes)),range=i.rte.markGetRange(n),l=i.rte.toHTML(range),o=e("<div/>",{"class":"rte2-frame-enhancement-inline",style:"position:absolute;top:0;left:0;height:1px;overflow:hidden;",html:e("<a/>",{target:"rte2-frame-enhancement-inline",href:a,style:"width:100%;display:block;",text:"."})}).appendTo("body").css({top:t.pageY,left:t.pageX}),r=o.find("a"),r.data("rte",i),r.data("mark",n),r.on("enhancementUpdate",function(e,t){i.inlineEnhancementReplaceMark(n,t)}),r.on("enhancementRead",function(e,t){t&&t.call(i,n,l)}),setTimeout(function(){r.click()},100))},inlineEnhancementReplaceMark:function(t,n){var a,o;o=this,n&&"string"===e.type(n)&&(a=o.rte.markGetRange(t),a.from&&o.rte.fromHTML(n,a))},tableCreate:function(t,n){var a,o,r,l;l=this,a=t?l.tableHTMLToData(t):[["",""]],void 0===n&&(n=l.rte.getRange().from.line),o=e("<div/>",{"class":"rte2-table"}).append(l.tableToolbarCreate()),r=e("<div/>",{"class":"rte2-table-placeholder",style:"overflow:hidden;height:auto;width:100%;"}).appendTo(o),r.handsontable({data:a,minCols:2,minRows:1,stretchH:"all",contextMenu:{callback:function(e,t){"edit"===e&&l.tableEditSelection(r)},items:{edit:{name:"Edit"},row_above:{},row_below:{},col_left:{},col_right:{},remove_row:{},remove_col:{},undo:{},redo:{}}},fillHandle:!1,renderAllRows:!0,autoColumnsSize:!0,autoRowSize:!0,renderer:"html",wordWrap:!0,outsideClickDeselects:!1,editor:!1,afterSelectionEnd:function(){return l.tableCancelEdit?void(l.tableCancelEdit=!1):void setTimeout(function(){l.tableEditSelection(r)},10)},afterCreateRow:function(){l.tableCancelEdit=!0},afterCreateCol:function(){l.tableCancelEdit=!0},afterRemoveRow:function(){l.tableCancelEdit=!0},afterRemoveCol:function(){l.tableCancelEdit=!0}}),mark=l.rte.enhancementAdd(o[0],n,{block:!0,toHTML:function(){return l.tableIsToBeRemoved(o)?"":l.tableDataToHTML(r.handsontable("getData"))}}),r.handsontable("render")},tableToolbarCreate:function(){var t,n;return t=this,n=e("<ul/>",{"class":"rte2-enhancement-toolbar"}),t.enhancementToolbarAddButton({text:"Up",tooltip:"Move Up",className:"rte2-enhancement-toolbar-up",onClick:function(){t.tableMove(n,-1)}},n),t.enhancementToolbarAddButton({text:"Down",tooltip:"Move Down",className:"rte2-enhancement-toolbar-down",onClick:function(){t.tableMove(n,1)}},n),t.enhancementToolbarAddButton({text:"Remove",className:"rte2-enhancement-toolbar-remove",onClick:function(){t.tableRemove(n)}},n),t.enhancementToolbarAddButton({text:"Restore",className:"rte2-enhancement-toolbar-restore",onClick:function(){t.tableRestore(n,!1)}},n),t.enhancementToolbarAddButton({text:"Remove Completely",className:"rte2-enhancement-toolbar-remove-completely",onClick:function(){t.tableRemoveCompletely(n)}},n),n},tableMove:function(t,n){var a,o,r,l,i,c;r=this,o=r.tableGetMark(t),o&&(1===n||-1===n)&&(a=r.tableGetWrapper(t),i=a.offset().top,o=r.rte.enhancementMove(o,n),l=a.offset().top,c=e(window).scrollTop(),e(window).scrollTop(c+l-i))},tableRemove:function(e){var t,n;n=this,t=n.tableGetWrapper(e),t.addClass("toBeRemoved")},tableRemoveCompletely:function(e){var t,n;n=this,t=n.tableGetMark(e),t&&n.rte.enhancementRemove(t)},tableRestore:function(e){var t,n;n=this,t=n.tableGetWrapper(e),t.removeClass("toBeRemoved")},tableIsToBeRemoved:function(e){var t,n;return n=this,t=n.tableGetWrapper(e),t.hasClass("toBeRemoved")},tableGetWrapper:function(t){var n;return n=this,e(t).closest(".rte2-table")},tableGetMark:function(e){var t;return t=this,e=t.tableGetWrapper(e),t.rte.enhancementGetMark(e)},tableHTMLToData:function(t){var n,a;return a=this,t=e(t),n=[],t.find(">tr,>tbody >tr").each(function(t,a){var o;o=[],e(a).find(">td,>th").each(function(t,n){o.push(e(n).html())}),n.push(o)}),n},tableDataToHTML:function(t){var n,a;return a=this,n="<table>",e.each(t,function(t,a){n+="<tr>",e.each(a,function(e,t){n+="<td>"+t+"</td>"}),n+="</tr>"}),n+="</table>"},tableEditInit:function(){var t;t=this,t.$tableEditDiv||(t.$tableEditDiv=e("<div>",{"class":"rte2-table-editor"}).appendTo(document.body),t.$tableEditTextarea=e("<textarea>").appendTo(t.$tableEditDiv),t.tableEditRte=Object.create(a),t.tableEditRte.init(t.$tableEditTextarea),t.$tableEditDiv.popup().popup("close"),t.$tableEditDiv.popup("container").attr("name","rte2-frame-table-editor"))},tableEditSelection:function(e){var t,n,a;n=this,t=e.handsontable("getSelected"),n.tableEditInit(),a=e.handsontable("getValue")||"",n.$tableEditDiv.popup("open"),n.tableEditRte.fromHTML(a),n.tableEditRte.focus(),n.tableEditRte.refresh(),e.handsontable("deselectCell"),n.$tableEditDiv.popup("container").one("closed",function(){a=n.tableEditRte.toHTML(),e.handsontable("setDataAtCell",t[0],t[1],a)})},placeholderInit:function(){var t,n;n=this,n.placeholderRefresh(),t=setInterval(function(){e.contains(document,n.$el[0])?n.placeholderRefresh():clearInterval(t)},200)},placeholderRefresh:function(){var e,t,n,a;a=this,n=a.$el.attr("placeholder")||"",e="rte2-placeholder",t=a.rte.getCount(),0===t&&n?a.$editor.attr(e,n):a.$editor.removeAttr(e)},previewInit:function(){var t;t=this,t.$container.on("rteChange",e.debounce(2e3,function(){t.previewUpdate()}))},previewUpdate:function(){var e,t;t=this,e=t.toHTML(),e!==t.previewUpdateSaved&&(t.previewUpdateSaved=e,t.$el.val(e).trigger("input"))},fromHTML:function(e){var t;return t=this,t.rte.fromHTML(e)},toHTML:function(){var e,t;return t=this,e="rich"===t.rte.modeGet()?t.rte.toHTML():t.$el.val()},toText:function(){var e,t;return e=this,t=e.rte.toText()},focus:function(){var e;e=this,"rich"===e.rte.modeGet()?(e.rte.focus(),e.toolbarUpdate(),e.rte.refresh()):e.$el.focus()},refresh:function(){var e;e=this,e.rte.refresh()},setCursor:function(e,t){var n;n.rte.setCursor(e,t)}},RICH_TEXT_ELEMENTS.length>0){a.toolbarConfig.push({separator:!0});var r=[];e.each(RICH_TEXT_ELEMENTS,function(e,t){var n=t.tag,o=t.styleName;a.styles[o]={className:"rte2-style-"+o,enhancementType:t.typeId,enhancementName:t.displayName,element:n,elementAttrAny:!0,singleLine:!0},r.push({className:"rte2-toolbar-noicon",style:o,text:t.displayName})}),a.toolbarConfig.push({text:"Inline",submenu:r})}return e.plugin2("rte2",{_defaultOptions:{inline:!1},_create:function(t){var n,o,r,l;o=e(t),r=e.extend(!0,{},this.option()),n=o.data("inline"),void 0!==n&&(r.inline=n),o.data("rte2-options",r),l=Object.create(a),l.init(t,r)},enable:function(){return this}}),
e(window).bind("resize.rte scroll.rte",e.throttle(150,function(){e(window).trigger("rteHoistToolbar")})),a});