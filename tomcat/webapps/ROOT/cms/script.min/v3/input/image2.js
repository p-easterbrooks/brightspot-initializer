define(["jquery","bsp-utils","v3/input/richtext2","pixastic/pixastic.core","pixastic/actions/blurfast","pixastic/actions/brightness","pixastic/actions/crop","pixastic/actions/desaturate","pixastic/actions/fliph","pixastic/actions/flipv","pixastic/actions/invert","pixastic/actions/rotate","pixastic/actions/sepia","pixastic/actions/sharpen"],function(t,e,i){var o;return o={inputNames:"x y width height texts textSizes textXs textYs textWidths".split(" "),textDelimiter:"aaaf7c5a9e604daaa126f11e23e321d8",tabNames:{image:"Focus",edit:"Edit",sizes:"Sizes & Texts",hotspots:"Hotspots"},init:function(e,i){var o=this;o.$element=t(e),i&&t.extend(o,i),o.initDOM().done(function(){o.tabsInit(),o.focusInit(),o.editInit(),o.sizesInit(),o.textInit(),o.hotspotInit(),o.adjustmentProcess(),o.tabsReady(),o.adjustmentProcessTimerStart()})},initDOM:function(){var t,e,i,o;return o=this,e=o.$element,t={},o.dom=t,t.$form=e.closest("form"),t.$imageContainer=e.find(".imageEditor-image"),t.$image=t.$imageContainer.find("img"),t.imageSrc=t.$image.attr("src"),t.$imageClone=t.$image.clone(),t.imageClone=t.$imageClone[0],i=t.$image.attr("data-scale"),(void 0===i||""===i)&&(i=1),o.scale=i,t.$aside=e.find("> .imageEditor-aside"),t.$tools=e.find(".imageEditor-tools ul"),t.$edit=e.find(".imageEditor-edit"),t.$sizes=e.find(".imageEditor-sizes"),t.$sizesTable=t.$sizes.find("table"),o.dataName=e.closest(".inputContainer").attr("data-name"),t.$focusInputX=t.$imageContainer.find('input[name$=".focusX"]'),t.$focusInputY=t.$imageContainer.find('input[name$=".focusY"]'),o.getImageSize(t.$image).done(function(t,e){o.dom.imageCloneWidth=t,o.dom.imageCloneHeight=e})},tabsInit:function(){var t;t=this,t.dom.tabs={}},tabsCreate:function(e,i){var o;o=this,o.dom.tabs=o.dom.tabs||{},o.tabNames[e]&&(o.dom.tabs[e]=t("<div/>",{"class":i||"","data-tab":o.tabNames[e],style:"position:relative"}))},tabsReady:function(){var e;e=this,t.each(e.dom.tabs,function(){var i=t(this);i.appendTo(e.$element)}),e.$element.addClass("tabbed"),e.$element.tabbed()},editInit:function(){var e,i,o,a,s;s=this,s.tabsCreate("edit"),s.dom.$editImage=s.dom.$imageClone.clone(),s.dom.$originalImage=s.dom.$editImage,t("<div/>",{"class":"imageEditor-image",html:s.dom.$editImage}).appendTo(s.dom.tabs.edit),s.dom.$aside.appendTo(s.dom.tabs.edit),s.dom.$editInputs=t("<div/>").appendTo(s.dom.$edit),s.dom.$edit.find("table").hide(),e=t('<div class="imageEditor-adjustment"><div class="imageEditor-adjustment-heading">Brightness <span class="imageEditor-value">0</span></div></div>').appendTo(s.dom.$edit),s.dom.$editBrightnessValue=e.find(".imageEditor-value"),s.dom.$editBrightness=s.dom.$edit.find('table :input[name$=".brightness"]').on("change input",function(){s.dom.$editBrightnessValue.text(t(this).val())}).trigger("change").appendTo(e),i=t('<div class="imageEditor-adjustment"><div class="imageEditor-adjustment-heading">Contrast <span class="imageEditor-value">0</span></div></div>').appendTo(s.dom.$edit),s.dom.$editContrastValue=i.find(".imageEditor-value"),s.dom.$editContrast=s.dom.$edit.find('table :input[name$=".contrast"]').on("change input",function(){s.dom.$editContrastValue.text(t(this).val())}).trigger("change").appendTo(i),a=t('<div class="imageEditor-adjustment"><div class="imageEditor-adjustment-heading">Rotate/Flip</div><ul class="imageEditor-adjustment-icons"></ul></div>').appendTo(s.dom.$edit).find("ul"),t("<li/>").append(t("<a/>",{title:"Rotate Left",text:"","class":"imageEditor-rotate-left"}).on("click",function(){return s.editRotateLeft(),!1})).appendTo(a),t("<li/>").append(t("<a/>",{title:"Rotate Right",text:"","class":"imageEditor-rotate-right"}).on("click",function(){return s.editRotateRight(),!1})).appendTo(a),t("<li/>").append(t("<a/>",{title:"Flip Horizontally",text:"","class":"imageEditor-flip-h"}).on("click",function(){return s.editFlipH(),!1})).appendTo(a),t("<li/>").append(t("<a/>",{title:"Flip Vertically",text:"","class":"imageEditor-flip-v"}).on("click",function(){return s.editFlipV(),!1})).appendTo(a),s.dom.$edit.find('table :input[name$=".rotate"]').attr({min:"-270",max:"270"}),o=t('<div class="imageEditor-adjustment"><div class="imageEditor-adjustment-heading">Filters</div><ul></ul></div>').appendTo(s.dom.$edit).find("ul"),s.dom.$editInvert=s.dom.$edit.find('table :input[name$=".invert"]'),t("<li/>",{html:t("<label>Invert</label>").prepend(s.dom.$editInvert)}).appendTo(o),s.dom.$editSepia=s.dom.$edit.find('table :input[name$=".sepia"]'),t("<li/>",{html:t("<label>Sepia</label>").prepend(s.dom.$editSepia)}).appendTo(o),s.dom.$editGrayscale=s.dom.$edit.find('table :input[name$=".grayscale"]'),t("<li/>",{html:t("<label>Grayscale</label>").prepend(s.dom.$editGrayscale)}).appendTo(o),s.dom.$editResetButton=t("<button/>",{type:"button",text:"Reset",click:function(){return s.editReset(),!1}}).appendTo(s.dom.$edit),s.dom.$edit.on("change",":input",function(){var e;e=s.editParseName(t(this).attr("name")),s.$element.trigger("imageAdjustment",[this,e])})},editInitInputs:function(){var e;e=this,e.dom.$editInputs=t("<div/>").appendTo(e.dom.$editButton)},editOpenAdjustments:function(){var t,e;e=this,t=e.dom.$edit,t.popup("source",e.dom.$editButton).popup("open"),e.adjustmentBlurShow()},editReset:function(){var e;e=this,e.dom.$edit.find(":input:not([type=button])").each(function(){var i,o,a;i=t(this),a=0,i.is(":checkbox")?(a=1,i.removeAttr("checked")):(a=parseFloat(i.val()),i.val(0)),0!==a&&(o=e.editParseName(i.attr("name")),i.trigger("change"),e.$element.trigger("imageAdjustment",[i.get(0),o]))}),e.$element.find(".imageEditor-blurOverlay").remove(),e.adjustmentProcess()},editParseName:function(t){return t=t||"",t.replace(/.*\./,"")},editRotateLeft:function(){var t;t=this,t.adjustmentRotateSet(t.adjustmentRotateGet()-90)},editRotateRight:function(){var t;t=this,t.adjustmentRotateSet(t.adjustmentRotateGet()+90)},editFlipH:function(){var t,e;e=this,t=Math.abs(e.adjustmentRotateGet()),0===t||180===t?e.adjustmentFlipHToggle():e.adjustmentFlipVToggle()},editFlipV:function(){var t,e;e=this,t=Math.abs(e.adjustmentRotateGet()),0===t||180===t?e.adjustmentFlipVToggle():e.adjustmentFlipHToggle()},adjustmentProcessTimerStart:function(){var t;t=this,t.adjustmentProcessTimerStop(),t.$element.closest("body").length&&t.adjustmentProcess().always(function(){t.adjustmentProcessTimer=setTimeout(function(){t.adjustmentProcessTimerStart()},100)})},adjustmentProcessTimerStop:function(){var t;t=this,clearTimeout(t.adjustmentProcessTimer)},adjustmentProcess:function(){var e,i,o,a;return a=this,e=a.adjustmentGetOperations(),i=JSON.stringify(e),i!==a.operationsPrevious&&(a.operationsPrevious=i,a.adjustmentSetInputs(),o=a.adjustmentProcessExecuteAll(e),o.done(function(){a.dom.$editImage!==a.dom.$originalImage&&a.dom.$editImage.remove(),a.dom.$originalImage.hide().before(a.dom.processedImage),a.dom.$editImage=t(a.dom.processedImage),a.$element.trigger("imageUpdated",[a.dom.$editImage])})),t.Deferred().resolve().promise()},adjustmentProcessExecuteAll:function(e){var i,o;return o=this,i=t.Deferred().resolve().promise(),o.dom.processedImage=o.dom.$imageClone.clone().get(0),t.each(e,function(e,a){var s;s=a.data||[a],t.each(s,function(t,a){var s;s=i,i=s.then(function(){return o.adjustmentProcessExecuteSingle(e,a)})})}),i},adjustmentProcessExecuteSingle:function(e,i){var o,a;return a=this,o=t.Deferred(),Pixastic.process(a.dom.processedImage,e,i,function(t){a.dom.processedImage=t,o.resolve()}),o.promise()},adjustmentSetInputs:function(){var e;e=this,e.dom.$editInputs.empty(),e.dom.$edit.find(":input:not([type=button])").each(function(){var i=t(this);(!i.is(":checkbox")||i.is(":checked"))&&e.dom.$editInputs.append(t("<input/>",{type:"hidden",name:i.attr("name"),value:i.val()}))})},adjustmentGetOperations:function(){var e;return e=this,e.operations={},e.dom.$edit.find(":input:not([type=hidden])").each(function(){var i,o,a,s;i=t(this),o=e.editParseName(i.attr("name")),o&&(a=i.is(":checkbox")?i.is(":checked"):parseFloat(i.val()),a===!1||isNaN(a)||0===a||(s="adjustmentGetOperation_"+o,e[s]&&e[s](a)))}),e.operations},adjustmentGetOperation_brightness:function(t){var e,i;i=this,e=i.operations,e.brightness=e.brightness||{},e.brightness.brightness=150*t,e.brightness.legacy=!0},adjustmentGetOperation_contrast:function(t){var e,i;i=this,e=i.operations,e.brightness=e.brightness||{},e.brightness.contrast=0>t?t:3*t},adjustmentGetOperation_flipH:function(){var t,e;e=this,t=e.operations,t.fliph=t.fliph||{}},adjustmentGetOperation_flipV:function(){var t,e;e=this,t=e.operations,t.flipv=t.flipv||{}},adjustmentGetOperation_grayscale:function(){var t,e;e=this,t=e.operations,t.desaturate=t.desaturate||{}},adjustmentGetOperation_sepia:function(){var t,e;e=this,t=e.operations,t.sepia=t.sepia||{}},adjustmentGetOperation_invert:function(){var t,e;e=this,t=e.operations,t.invert=t.desaturate||{}},adjustmentGetOperation_rotate:function(t){var e,i;i=this,e=i.operations,e.rotate=e.rotate||{},e.rotate.angle=-t},adjustmentGetOperation_sharpen:function(t){var e,i;i=this,e=i.operations,e.sharpen=e.sharpen||{},e.sharpen.amount=t},adjustmentGetOperation_blur:function(t){var e,i,o,a;o=this,e=o.operations,e.blurfast=e.blurfast||{count:0,data:[]},a=t.split("x"),i={left:a[0],top:a[1],width:a[2],height:a[3]},e.blurfast.data[e.blurfast.count]={amount:1,rect:i},e.blurfast.count++},adjustmentRotateGet:function(){var t,e;return t=this,e=parseInt(t.dom.$edit.find(":input[name$='.rotate']").val()||0,10)},adjustmentRotateSet:function(t){var e;e=this,Math.abs(t)>=360&&(t=0),-180===t&&(t=180),270===t?t=-90:-270===t&&(t=90),e.dom.$edit.find(":input[name$='.rotate']").val(t).trigger("change")},adjustmentFlipHGet:function(){var t,e;return t=this,e=t.dom.$edit.find(":input[name$='.flipH']").is(":checked")},adjustmentFlipHSet:function(t){var e;e=this,e.dom.$edit.find(":input[name$='.flipH']").prop("checked",t)},adjustmentFlipHToggle:function(){var t;t=this,t.adjustmentFlipHSet(!t.adjustmentFlipHGet())},adjustmentFlipVGet:function(){var t,e;return t=this,e=t.dom.$edit.find(":input[name$='.flipV']").is(":checked")},adjustmentFlipVSet:function(t){var e;e=this,e.dom.$edit.find(":input[name$='.flipV']").prop("checked",t)},adjustmentFlipVToggle:function(){var t;t=this,t.adjustmentFlipVSet(!t.adjustmentFlipVGet())},adjustmentBlurShow:function(){var e;e=this,e.dom.$edit.find("input[name='"+e.dataName+".blur']").each(function(){var e;e=t(this).val().split("x")})},sizesInit:function(){var e;e=this,e.tabsCreate("sizes"),e.$element.find(".imageEditor-image").appendTo(e.dom.tabs.sizes),e.dom.$sizesAside=t("<div/>",{"class":"imageEditor-aside"}).appendTo(e.dom.tabs.sizes),e.dom.$sizes.appendTo(e.dom.$sizesAside),e.coverInit(),e.sizesGetSizeInfo(),e.dom.$sizeSelectors=t("<ul/>",{"class":"imageEditor-sizeSelectors"}),t.each(e.sizeGroups,function(i,o){var a,s,n;s=t("<li/>",{"class":"imageEditor-sizeButton"}).appendTo(e.dom.$sizeSelectors),s.attr("data-group-name",i),o.$element=s,a=t("<span/>",{"class":"imageEditor-sizeLabel"}).appendTo(s),o.$groupLabel=a,t.each(o.sizeInfos,function(e,i){n?a.append("<br/>"):n=!0,t("<span/>",{title:i.description+" ("+i.width+" x "+i.height+")",html:i.description}).appendTo(a)}),t("<div/>",{"class":"imageEditor-sizePreview",html:t("<img/>",{alt:a.text(),src:e.dom.imageSrc,load:function(){e.sizesUpdatePreview(i)}})}).appendTo(s),s.on("click",function(){return e.sizesIsSelected(i)?e.sizesUnselect():e.sizesSelect(i),!1}),e.sizeBoxInit(i)}),e.dom.$sizesTable.before(e.dom.$sizeSelectors).hide(),e.sizesSelectSingle(),e.scrollFix(e.dom.$sizesAside),e.$element.on("imageAdjustment",function(t,i,o){"rotate"===o&&e.sizesResetAll()}),e.$element.on("imageUpdated",t.throttle(2e3,function(i,o){var a;a=t(e.cloneCanvas(o.get(0))),e.dom.$image.before(a),e.dom.$image.remove(),e.dom.$image=a,e.sizesNeedsUpdate=!0})),e.dom.tabs.sizes.on("tabbedShow",function(){e.sizesNeedsUpdate&&(e.sizesNeedsUpdate=!1,setTimeout(function(){var t;t=e.sizesGetSelected(),t&&e.sizesSelect(t),e.sizesUpdatePreview()},100))})},sizesGetSizeInfo:function(){var e,i;i=this,i.sizeInfos={},i.sizeGroups={},e={},i.dom.$sizesTable.find("th").each(function(){var o,a,s,n,d,r,h,p,l,c,u,m,g,f;if(g=t(this),f=g.closest("tr"),l=f.attr("data-size-name"),r=g.text(),a="true"===f.attr("data-size-independent"),c=parseFloat(f.attr("data-size-width")),h=parseFloat(f.attr("data-size-height")),n=c/h,(0===c||0===h)&&(n=0,a=!0),m=g.popup("source"),!(m&&(u=m.closest(".inputContainer").attr("data-standard-image-sizes"),u&&t.inArray(l,u.split(" "))<0))){s={},t.each(i.inputNames,function(t,e){s[e]=f.find(':input[name$=".'+e+'"]')});var v={},x=i.dom.$focusInputX.val(),$=i.dom.$focusInputY.val();if(""!==x&&""!==$){var z=i.dom.$focusImage[0];v=i.focusGetCrop({x:x,y:$},{width:z.width,height:z.height},{width:c,height:h})}p=i.sizeInfos[l]={name:l,description:r,inputs:s,independent:a,width:c,height:h,aspectRatio:n,focusCrop:v},a?o=i.sizesCreateGroup(l):(d=Math.floor(100*n)/100,o=e[""+d],o||(o=i.sizesCreateGroup(d),e[d]=o,e[d-.02]=e[d-.02]||o,e[d-.01]=e[d-.01]||o,e[d+.01]=e[d+.01]||o,e[d+.02]=e[d+.02]||o)),o.sizeInfos[l]=p}})},sizesSelect:function(t){var e;e=this,e.sizesUnselect(),e.sizeGroups[t].$element.addClass("imageEditor-sizeSelected"),e.sizeBoxShow(t),e.textSelectGroup(t),e.resetCropShow(t)},sizesUnselect:function(){var t;t=this,t.dom.$sizeSelectors.find("li").removeClass("imageEditor-sizeSelected"),t.sizeBoxHide(),t.textUnselect(),t.resetCropHide()},sizesIsSelected:function(t){var e;return e=this,e.sizeGroups[t].$element.hasClass("imageEditor-sizeSelected")},sizeInfoIsEmpty:function(t){var e;return e=t.inputs,"0.0"===e.x.val()&&"0.0"===e.y.val()&&"0.0"===e.width.val()&&"0.0"===e.height.val()},sizesSelectSingle:function(){var e;e=this,1===e.sizeGroups.length&&t.each(e.sizeGroups,function(t){return e.sizesSelect(t),!1})},sizesGetSelected:function(){var t;return t=this,t.dom.$sizeSelectors.find(".imageEditor-sizeSelected").attr("data-group-name")||""},sizesCreateGroup:function(e){var i;return i=this,i.sizeGroups[e]={$element:t(),sizeInfos:{}}},sizesUpdatePreview:function(e){var i,o,a,s;a=this,e?(i={},i[e]=a.sizeGroups[e]):i=a.sizeGroups,t.each(i,function(t,e){var i,n,d,r,h,p;h=a.sizesGetGroupFirstSizeInfo(t),d=e.$element.find(".imageEditor-sizePreview"),r=a.adjustmentRotateGet(),90===r||-90===r?(p=a.dom.imageCloneHeight,n=a.dom.imageCloneWidth):(p=a.dom.imageCloneWidth,n=a.dom.imageCloneHeight),i=a.sizesGetSizeBounds(p,n,h),s=a.sizesGetImageArea(p,n,h);var l,c,u,m;l=Number(h.inputs.x.val()),c=Number(h.inputs.y.val()),u=Number(h.inputs.width.val()),m=Number(h.inputs.height.val());var g=0>c?Math.abs(c)/i.height*n:0,f=c+m>1?(c+m-1)/i.height*n:0,v=0>l?Math.abs(l)/i.width*p:0,x=l+u>1?(l+u-1)/i.width*p:0;i.top-=s.topPadPx,i.left-=s.leftPadPx,i.height=i.height*(1-f-g),i.width=i.width*(1-v-x),d.css({padding:100*g+"% "+100*x+"% "+100*f+"% "+100*v+"%"}),o=a.adjustmentGetOperations(),o.crop=i,a.adjustmentProcessExecuteAll(o).done(function(){d.empty().append(a.dom.processedImage)})})},sizesGetSizeBounds:function(t,e,i){var o,a,s,n,d,r,h;n=this;var p=n.sizeInfoIsEmpty(i);if(p?(s=parseFloat(i.focusCrop.x)||0,d=parseFloat(i.focusCrop.y)||0,r=parseFloat(i.focusCrop.width)||0,a=parseFloat(i.focusCrop.height)||0):(s=parseFloat(i.inputs.x.val())||0,d=parseFloat(i.inputs.y.val())||0,r=parseFloat(i.inputs.width.val())||0,a=parseFloat(i.inputs.height.val())||0),o=i.aspectRatio,h=n.sizesGetImageArea(t,e,i),0===r||0===a)if(r=i.width,a=i.height,o){r=e*o,a=t/o,r>t?r=a*o:a=r/o;var l=h.totalWidth-t,c=h.totalHeight-e;s=0!==l?l/2:(t-r)/2,d=0!==c?c/2:(e-a)/2}else s=0,d=0,r=t,a=e;else s=(s+h.left)*t,d=(d+h.top)*e,r*=t,a*=e;return{left:s,top:d,width:r,height:a}},sizesGetImageArea:function(t,e,i){var o,a,s,n,d,r;return o=t/e,a=i.aspectRatio,s=Math.max(o/a-1,0)/2,n=Math.max(a/o-1,0)/2,n>s?(d=e,r=d*a):(r=t,d=r/a),{top:s,left:n,topPadPx:s*e,leftPadPx:n*t,totalWidth:r,totalHeight:d,scale:1/(1+2*n)}},sizesSetGroupBounds:function(e,i){var o,a;o=this,a=o.sizeGroups[e],t.each(a.sizeInfos,function(){var e=this;t.each(i,function(t,i){e.inputs[t].val(i)})})},sizesResetAll:function(){var e;e=this,t.each(e.sizeGroups,function(t){e.sizesResetGroup(t)})},sizesResetGroup:function(e){var i,o;o=this,i=o.sizeGroups[e],t.each(i.sizeInfos,function(){var t=this;t.inputs.x.val("0.0"),t.inputs.y.val("0.0"),t.inputs.width.val("0.0"),t.inputs.height.val("0.0")})},sizesGetGroupFirstSizeInfo:function(e){var i,o,a;return o=this,i=o.sizeGroups[e],t.each(i.sizeInfos,function(t,e){return a=e,!1}),a},sizesGetGroupAspectRatio:function(t){var e;return e=this,e.sizesGetGroupFirstSizeInfo(t).aspectRatio},coverInit:function(){var e,i;i=this,e=t("<div/>",{"class":"imageEditor-cover",css:{display:"none",left:"0",position:"absolute",top:"0"}}),i.dom.$coverTop=e,i.dom.$coverLeft=e.clone(!0),i.dom.$coverRight=e.clone(!0),i.dom.$coverBottom=e.clone(!0),i.dom.$covers=t().add(i.dom.$coverTop).add(i.dom.$coverLeft).add(i.dom.$coverRight).add(i.dom.$coverBottom).appendTo(i.dom.tabs.sizes)},coverUpdate:function(t,e){var i,o,a,s,n;i=this,o=i.dom.$image.width(),a=i.dom.$image.height();var d=i.sizesGetImageArea(o,a,e);s=t.left+t.width*d.scale,n=t.top+t.height*d.scale;var r=d.totalWidth*d.scale,h=d.totalHeight*d.scale;i.dom.$coverTop.css({height:t.top,width:r}),i.dom.$coverLeft.css({height:t.height*d.scale,top:t.top,width:t.left}),i.dom.$coverRight.css({height:t.height*d.scale,left:s,top:t.top,width:r-s}),i.dom.$coverBottom.css({height:h-n,top:n,width:r}),i.coverShow()},coverHide:function(){var t;t=this,t.dom.$covers.hide()},coverShow:function(){var t;t=this,t.dom.$covers.show()},sizeBoxInit:function(e){var i,o,a,s,n;o=this,i=o.sizeGroups[e],a=t("<div/>",{"class":"imageEditor-sizeBox",css:{position:"absolute"}}).hide().appendTo(o.dom.tabs.sizes),i.$sizeBox=a,s=t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-topLeft"}).appendTo(a),n=t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-bottomRight"}).appendTo(a),s.on("mousedown",o.sizeBoxMousedownDragHandler(e,function(t,e,i){return{left:e.left+i.constrainedX,top:e.top+i.constrainedY,width:e.width-i.constrainedX,height:e.height-i.constrainedY}})),n.on("mousedown",o.sizeBoxMousedownDragHandler(e,function(t,e,i){return{width:e.width+i.constrainedX,height:e.height+i.constrainedY}})),a.on("mousedown",o.sizeBoxMousedownDragHandler(e,function(t,e,i){return{moving:!0,left:e.left+i.x,top:e.top+i.y}}))},sizeBoxShow:function(t){var e,i,o,a;i=this,o=i.sizesGetGroupFirstSizeInfo(t);var s=i.dom.$image.width(),n=i.dom.$image.height(),d=i.dom.$imageContainer;if(e=i.sizesGetSizeBounds(s,n,o),a=i.sizesGetImageArea(s,n,o),a.topPadPx<a.leftPadPx){var r=i.dom.$image.width(),h={transform:"scale("+a.scale+")","transform-origin":"top left"};d.css(h),d.css({"padding-left":a.leftPadPx+"px",width:d.width()+2*a.leftPadPx+"px"}),i.dom.$image.width(r)}else d.css({"padding-top":a.topPadPx+"px",height:d.height()+2*a.topPadPx+"px"});e.left*=a.scale,e.top*=a.scale,i.coverUpdate(e,o),i.coverShow(),i.sizeBoxUpdate(t,e),i.sizeGroups[t].$sizeBox.show()},sizeBoxUpdate:function(t,e){var i,o,a,s,n;i=this,o=i.dom.$imageContainer,s=i.sizesGetGroupFirstSizeInfo(t),a=i.sizesGetImageArea(i.dom.$image.width(),i.dom.$image.height(),s);var d={transform:"scale("+a.scale+")","transform-origin":"top left"};n=i.sizeGroups[t].$sizeBox,n.css(e),n.css(d),n.data("exactHeight",e.height),n.data("exactWidth",e.width)},sizeBoxHide:function(){var e;e=this,e.coverHide(),t.each(e.sizeGroups,function(t,e){e.$sizeBox.hide()}),e.dom.$imageContainer.attr("style","")},sizeBoxRefresh:function(t){var e;e=this,e.sizeBoxHide(),e.sizeBoxShow(t)},sizeBoxMousedownDragHandler:function(e,i){var o,a,s;return a=this,s=a.sizeGroups[e].$sizeBox,o=function(o){var n,d,r,h,p,l,c,u,m;r=this,d=a.sizesGetGroupFirstSizeInfo(e),n=d.aspectRatio,m=s.position(),u={left:m.left,top:m.top,width:s.width(),height:s.width()/n,pageX:o.pageX,pageY:o.pageY},h=a.dom.$image.width(),p=a.dom.$image.height();var g=a.sizesGetImageArea(h,p,d);l=g.totalWidth,c=g.totalHeight;var f=l*g.scale,v=c*g.scale;return t.drag(r,o,function(){},function(o){var r,h,p,l;h=o.pageX-u.pageX,p=o.pageY-u.pageY,r=i(o,u,{x:h,y:p,constrainedX:n?Math.max(h,p*n):h,constrainedY:n?Math.max(p,h/n):p}),r=t.extend({},u,r),r.moving?(r.left<0&&(r.left=0),r.top<0&&(r.top=0),l=r.left+r.width*g.scale-f,l>0&&(r.left-=l),l=r.top+r.height*g.scale-v,l>0&&(r.top-=l)):((r.width<10||r.height<10)&&(n>1?(r.width=10*n,r.height=10):(r.width=10,r.height=n?10/n:10)),r.left<0&&(r.width+=r.left,n&&(r.height=r.width/n,r.top-=r.left/n),r.left=0),r.top<0&&(r.height+=r.top,n&&(r.width=r.height*n,r.left-=r.top*n),r.top=0),l=r.left+r.width*g.scale-f,l>0&&(r.width-=l/g.scale,n&&(r.height=r.width/n)),l=r.top+r.height*g.scale-v,l>0&&(r.height-=l/g.scale,n&&(r.width=r.height*n))),a.coverUpdate(r,d),a.sizeBoxUpdate(e,r),r.moving||s.trigger("sizeBoxResize")},function(){var t,i,o,n,d;i=s.position(),o=s.data("exactWidth"),t=s.data("exactHeight"),n=i.left/g.scale/h-g.left,d=i.top/g.scale/p-g.top,a.sizesSetGroupBounds(e,{x:n,y:d,width:o/h,height:t/p}),a.sizesUpdatePreview(e),s.trigger("sizeBoxResize")}),!1}},focusInit:function(){var e,i;e=this,e.tabsCreate("image","imageEditor-focus"),e.dom.$focusImage=e.dom.$imageClone.clone(),t("<div/>",{"class":"imageEditor-image",html:e.dom.$focusImage}).appendTo(e.dom.tabs.image),e.dom.$focusAside=t("<div/>",{"class":"imageEditor-aside"}).appendTo(e.dom.tabs.image),""!==e.dom.$focusInputX.val()&&""!==e.dom.$focusInputY.val()&&e.insertFocusPoint(e.dom.$focusImage,100*e.dom.$focusInputX.val(),100*e.dom.$focusInputY.val()),i="<p>Click inside the image to set a focus point for all image sizes.</p>",e.dom.$focusMessage=t("<div/>",{"class":"imageEditor-focus-message",html:i}).appendTo(e.dom.$focusAside),e.$element.on("imageUpdated",function(i,o){var a;a=t(e.cloneCanvas(o.get(0))),e.dom.$focusImage.before(a),e.dom.$focusImage.remove(),e.dom.$focusImage=a}),e.dom.$focusImage.parent().on("click","img,canvas",function(i){var o,a,s,n,d;a=t(this),d=a.width(),n=a.height(),s={width:d,height:n},o=e.getClickPositionInElement(a,i),t.each(e.sizeGroups,function(t){var i,a;a=e.sizesGetGroupFirstSizeInfo(t),i={width:a.width,height:a.height},a.focusCrop=e.focusGetCrop({x:o.xPercent,y:o.yPercent},s,i),e.sizesUpdatePreview(t)}),e.sizesNeedsUpdate=!0,e.dom.$focusInputX.val(o.xPercent),e.dom.$focusInputY.val(o.yPercent),e.insertFocusPoint(e.dom.$focusImage,100*o.xPercent,100*o.yPercent),e.dom.$focusPoint.css({left:100*o.xPercent+"%",top:100*o.yPercent+"%"}),e.$element.trigger("change")})},insertFocusPoint:function(e,i,o){var a=this;a.dom.$focusPoint||(a.dom.$focusPoint=t("<div/>",{"class":"imageEditor-focus-point"}).appendTo(a.dom.$focusImage.parent())),a.dom.$focusPoint.css({left:i+"%",top:o+"%"})},focusGetCrop:function(t,e,i){var o,a,s,n,d,r,h;return s={x:0,y:0,width:1,height:1},o=e.width/e.height,a=0===i.width||0===i.height?0:i.width/i.height,0===a||(o>a?(n=e.height*a,d=e.width-n,r=d/e.width,s.width=1-r,s.x=r/2,h=s.x-(.5-t.x),0>h?h=0:h+s.width>1&&(h=1-s.width),s.x=h):a>o&&(n=e.width/a,d=e.height-n,r=d/e.height,s.height=1-r,s.y=r/2,h=s.y-(.5-t.y),0>h?h=0:h+s.height>1&&(h=1-s.height),s.y=h)),s},resetCropShow:function(e){var i;i=this,t("<a/>",{"class":"imageEditor-resetCrop",text:"Reset Crop",click:function(){return i.sizesResetGroup(e),i.sizesUpdatePreview(e),i.sizeBoxRefresh(e),!1}}).insertAfter(i.sizeGroups[e].$groupLabel)},resetCropHide:function(){var t;t=this,t.$element.find(".imageEditor-resetCrop").remove()},textInit:function(){var e;e=this,e.textInfoIndex=1,t.each(e.sizeGroups,function(i,o){o.textInfos=e.textGetTextInfo(i),t.each(o.textInfos,function(t){e.textOverlayAdd(i,t)}),o.$sizeBox.on("sizeBoxResize",function(){e.textOverlaySetFont(i)})}),e.dom.$form.submit(function(){t.each(e.sizeGroups,function(t){e.textSetTextInfo(t)})})},textSelectGroup:function(t){var e;e=this,e.textButtonCreate(t),e.textOverlaySetFont(t)},textUnselect:function(){var t;t=this,t.textButtonRemove()},textButtonCreate:function(e){var i;i=this,t("<a/>",{"class":"imageEditor-addTextOverlay",text:"Add Text",click:function(){return i.textAdd(e),!1}}).insertAfter(i.sizeGroups[e].$groupLabel)},textButtonRemove:function(){var t;t=this,t.$element.find(".imageEditor-addTextOverlay").remove()},textGetTextInfo:function(e){var i,o,a,s,n,d,r,h,p;return o=this,i=o.sizeGroups[e],a=o.sizesGetGroupFirstSizeInfo(e),a.inputs.texts.val()?(n=a.inputs.texts.val().split(o.textDelimiter),h=a.inputs.textXs.val().split(o.textDelimiter),p=a.inputs.textYs.val().split(o.textDelimiter),r=a.inputs.textWidths.val().split(o.textDelimiter),d=a.inputs.textSizes.val().split(o.textDelimiter),s={},t.each(n,function(t){0!==t&&(s[o.textInfoIndex++]={text:o.htmlDecode(n[t]),x:h[t],y:p[t],width:r[t],size:d[t]})}),s):{}},textSetTextInfo:function(e){var i;i=this,t.each(i.sizeGroups[e].sizeInfos,function(o,a){var s,n,d,r,h;s="",n="",d="",r="",h="",t.each(i.sizeGroups[e].textInfos,function(t,e){var o,p,l;p=e.$textOverlay.find(".imageEditor-textOverlayInput"),p.length&&(l=p.data("rte2"),e.text=l?l.toHTML():p.val()),s+=i.textDelimiter+e.text,n+=i.textDelimiter+parseFloat(e.x).toFixed(3),d+=i.textDelimiter+parseFloat(e.y).toFixed(3),r+=i.textDelimiter+parseFloat(e.width).toFixed(3),o=e.originalFontSize||16,e.size=o/(a.height?a.height:a.width),h+=i.textDelimiter+e.size.toFixed(3)}),a.inputs.texts.val(s||""),a.inputs.textXs.val(n||""),a.inputs.textYs.val(d||""),a.inputs.textWidths.val(r||""),a.inputs.textSizes.val(h||"")})},textAdd:function(t){var e,i,o;i=this,e=i.sizeGroups[t],o=i.textInfoIndex++,e.textInfos[o]={text:"",x:.25,y:.25,width:.5,size:0},i.textOverlayAdd(t,o,!0)},textOverlayAdd:function(e,o,a){var s,n,d,r,h,p,l;n=this,s=n.sizeGroups[e],r=s.textInfos[o],r&&(d=s.$sizeBox,h=t("<div/>",{"class":"imageEditor-textOverlay",css:{left:100*r.x+"%",position:"absolute",top:100*r.y+"%",width:100*r.width+"%","z-index":1}}).appendTo(d),h.data("textInfoKey",o),h.data("groupName",e),r.$textOverlay=h,t("<div/>",{"class":"imageEditor-textOverlayLabel",text:"Text #"+o}).on("mousedown",n.textMousedownDragHandler(function(t,e,i){return{moving:!0,left:e.left+i.x,top:e.top+i.y}})).appendTo(h),t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-left",mousedown:n.textMousedownDragHandler(function(t,e,i){return{left:e.left+i.x,width:e.width-i.x}})}).appendTo(h),t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-right",mousedown:n.textMousedownDragHandler(function(t,e,i){return{left:e.left,width:e.width+i.x}})}).appendTo(h),t("<div/>",{"class":"imageEditor-textOverlayRemove",text:"Remove",click:function(){return h.remove(),n.textOverlayRemove(e,o),!1}}).appendTo(h),p=t("<input/>",{"class":"imageEditor-textOverlayInput",type:"text",value:r.text||""}).appendTo(h),l=t("<div/>",{"class":"imageEditor-text-toolbar"}).hide(),n.dom.tabs.sizes.before(l),p.on("rteFocus",function(){return n.$element.find(".imageEditor-text-toolbar").hide(),l.show(),!1}),rte=Object.create(i),rte.init(p,{inline:!0,toolbarLocation:l}),r.rte=rte,r.$toolbar=l,n.textOverlaySetFont(e,o),a&&(p.focus(),n.$element.find(".imageEditor-text-toolbar").hide(),l.show()))},textOverlaySetFont:function(e,i){var o,a,s,n,d;n=this,o=n.sizeGroups[e],d=o.$sizeBox,t.each(o.sizeInfos,function(t,e){return 0===e.height?(s="width",a=e.width,!1):void((void 0===a||e.height>a)&&(s="height",a=e.height))}),d.is(":visible")&&(d.find(".imageEditor-textOverlay").each(function(){var r,h,p,l,c,u,m,g;u=t(this),m=u.data("textInfoKey"),i&&m!==i||(g=o.textInfos[m],l=n.sizesGetGroupFirstSizeInfo(e).height,c=n.sizesGetGroupFirstSizeInfo(e).width,r=u.data("imageEditor-originalFontSize"),h=t(u),r||(r=parseFloat(h.css("font-size")),t.data(this,"imageEditor-originalFontSize",r)),r>0&&(h.css({"font-size":("height"===s?d.height():d.width())*(r/a),"line-height":1.2}),g.originalFontSize=r),p=u.find(".imageEditor-textOverlayInput").data("rte2"),p&&p.refresh())}),n.textSetTextInfo(e))},textOverlayRemove:function(t,e){var i,o;i=this,o=i.sizeGroups[t].textInfos,o[e].$toolbar.remove(),delete o[e],i.textSetTextInfo(t)},textMousedownDragHandler:function(e){var i,o;return o=this,i=function(i){var a,s,n,d,r,h,p,l,c,u,m;return a=this,h=t(a).closest(".imageEditor-textOverlay"),n=h.data("groupName")||"",l=h.data("textInfoKey")||"",s=o.sizeGroups[n],c=s.$sizeBox,p=s.textInfos[l],d=h.position(),u=c.width(),m=c.height(),r={left:d.left,top:d.top,width:h.width(),height:h.height(),pageX:i.pageX,pageY:i.pageY},i.dragImmediately=!0,t.drag(this,i,function(){},function(i){var o,a,s;o=i.pageX-r.pageX,a=i.pageY-r.pageY,s=e(i,r,{x:o,y:a}),s=t.extend({},r,s),s.left<0&&(s.left=0),s.top<0&&(s.top=0),s.top+r.height>m&&(s.top=m-r.height),s.moving?s.left+s.width>u&&(s.left=u-s.width):s.left+s.width>u&&(s.width=u-s.left),p.x=s.left/u,p.y=s.top/m,p.width=s.width/u,s.left=100*p.x+"%",s.top=100*p.y+"%",s.width=100*p.width+"%",s.height="auto",h.css(s)},function(){o.textSetTextInfo(n,s.textInfos)}),!1}},hotspotInit:function(){var e,i;i=this,i.dom.$hotspots=i.$element.closest(".inputContainer").find(".hotSpots"),0!==i.dom.$hotspots.length&&(i.tabsCreate("hotspots"),i.dom.$hotspotPopups=t("<div/>",{"class":"imageEditor-hotSpotPopups"}).appendTo(i.dom.$hotspots.closest("form")),i.dom.$hotspotImage=i.dom.$imageClone.clone(),i.dom.$hotspotImageWrapper=t("<div/>",{"class":"imageEditor-image",style:"position:relative",html:i.dom.$hotspotImage}).appendTo(i.dom.tabs.hotspots),e=i.dom.$hotspots.closest(".inputContainer"),i.dom.$hotspots.appendTo(i.dom.tabs.hotspots),e.hide(),i.dom.$hotspots.find("> ul").first().hide(),i.hotspotOverlayResetAll(),i.dom.$hotspots.on("create change",function(t){i.hotspotInputSetDefaults(),i.hotspotOverlayResetAll(),"change"===t.type&&i.hotspotEdit(t.target.closest("li"))}),i.$element.on("imageUpdated",function(e,o){var a;a=t(i.cloneCanvas(o.get(0))),i.dom.$hotspotImage.before(a),i.dom.$hotspotImage.remove(),i.dom.$hotspotImage=a,i.hotspotOverlayResetAll()}),i.dom.tabs.hotspots.on("tabbedShow",function(){i.hotspotOverlayResetAll()}))},hotspotOverlayResetAll:function(){var e;e=this,e.hotspotOverlayRemoveAll(),e.dom.$hotspots.find("> ul > li > .objectInputs").each(function(){var i,o;o=t(this),o.find(':input[name$="cms.image.x"], :input[name$="cms.image.y"], :input[name$="cms.image.width"], :input[name$="cms.image.height"]').closest(".inputContainer").hide(),i=t("<ul/>").append(o.closest("li")),i.popup({parent:e.dom.$hotspotPopups}).popup("close")}),e.dom.$hotspotPopups.find("ul > li > .objectInputs").each(function(){var i,o;o=t(this),i=e.hotspotInputGet(o),e.hotspotOverlayAdd(o.closest("li"),i)})},hotspotInputGet:function(e){var i,o,a,s,n,d,r,h;switch(r=this,n=t(e),h=r.dom.imageCloneWidth/r.scale,s=r.dom.imageCloneHeight/r.scale,o=h,i=s,a={x:Math.abs(parseInt(n.find(':input[name$="x"]').val())||1),y:Math.abs(parseInt(n.find(':input[name$="y"]').val())||1),width:Math.abs(parseInt(n.find(':input[name$="width"]').val())||0),height:Math.abs(parseInt(n.find(':input[name$="height"]').val())||0)},d=r.adjustmentRotateGet()){case-90:case 270:o=s,i=h,a={width:a.height,height:a.width,x:a.y,y:h-a.x-a.width};break;case 90:case-270:o=s,i=h,a={width:a.height,height:a.width,x:s-a.y-a.height,y:a.x};break;case 180:case-180:a={width:a.width,height:a.height,x:h-a.x-a.width,y:s-a.y-a.height}}return r.adjustmentFlipHGet()&&(90===d||-90===d?a.y=i-a.y-a.height:a.x=o-a.x-a.width),r.adjustmentFlipVGet()&&(90===d||-90===d?a.x=o-a.x-a.width:a.y=i-a.y-a.height),a.xPercent=a.x/o*100,a.yPercent=a.y/i*100,0===a.width?a.widthPercent=0:a.widthPercent=a.width/o*100,0===a.height?a.heightPercent=0:a.heightPercent=a.height/i*100,a},hotspotInputSet:function(e,i){var o,a,s,n,d,r,h,p,l,c;r=this,n=t(e),l=r.dom.$hotspotImage.width(),a=r.dom.$hotspotImage.height(),c=r.dom.imageCloneWidth/r.scale,s=r.dom.imageCloneHeight/r.scale,p=c,o=s,h=r.adjustmentRotateGet(),d=90===h||-90===h?l/s:l/c,t.each(i,function(t,e){i[t]=e/d}),90===h?(p=s,o=c,i={width:i.height,height:i.width,x:i.y,y:s-i.x-i.width}):-90===h&&(p=s,o=c,i={width:i.height,height:i.width,x:c-i.y-i.height,y:i.x}),r.adjustmentFlipHGet()&&(i.x=p-i.x-i.width),r.adjustmentFlipVGet()&&(i.y=o-i.y-i.height),n.find(':input[name$="x"]').val(parseInt(i.x)),
n.find(':input[name$="y"]').val(parseInt(i.y)),n.find(':input[name$="width"]').val(parseInt(i.width)),n.find(':input[name$="height"]').val(parseInt(i.height))},hotspotInputSetDefaults:function(){var e,i,o,a,s,n,d;n=this,d=n.dom.imageCloneWidth/n.scale,s=n.dom.imageCloneHeight/n.scale,e=parseInt(d/4),i=parseInt(s/4),o=parseInt(d/2),a=parseInt(s/2),n.dom.$hotspots.find(".objectInputs").each(function(){var s;s=t(this),s.find(':input[name$="x"]').val(function(t,i){return""===i?e:i}),s.find(':input[name$="y"]').val(function(t,e){return""===e?i:e}),s.find(':input[name$="width"]').val(function(t,e){return""===e?o:e}),s.find(':input[name$="height"]').val(function(t,e){return""===e?a:e})})},hotspotOverlayAdd:function(e,i){var o,a,s,n;n=this,s=t(e),o=t("<div/>",{"class":"imageEditor-hotSpotOverlay",css:{height:i.heightPercent+"%",left:i.xPercent+"%",position:"absolute",top:i.yPercent+"%",width:i.widthPercent+"%","z-index":1},click:function(){return n.hotspotEdit(s),!1}}).appendTo(n.dom.$hotspotImageWrapper),s.data("hotspotOverlay",o),o.data("hotspotInput",s),o.toggleClass("toBeRemoved",s.hasClass("toBeRemoved")),a=t("<div/>",{"class":"imageEditor-hotSpotOverlayBox",css:{height:"100%",position:"absolute",width:"100%","z-index":1}}).appendTo(o),t("<div/>",{"class":"imageEditor-textOverlayLabel",text:"HotSpot",mousedown:n.hotspotMousedownDragHandler(function(t,e,i){return s.addClass("state-focus"),n.hotspotSelect(s),{moving:!0,left:e.left+i.x,top:e.top+i.y}})}).appendTo(o),t("<div/>",{"class":"imageEditor-textOverlayRemove",text:"Remove",click:function(){return n.hotspotRemove(o),!1}}).appendTo(o),0===i.width?(o.css("width","10px"),o.css("height","10px")):t("<div/>",{"class":"imageEditor-resizer imageEditor-resizer-bottomRight",mousedown:n.hotspotMousedownDragHandler(function(t,e,i){return s.addClass("state-focus"),n.hotspotSelect(s),{width:e.width+i.x,height:e.height+i.y}})}).appendTo(a)},hotspotEdit:function(e){var i,o,a;a=this,o=t(e),a.hotspotSelect(o),i=o.data("hotspotOverlay"),a.$element.find(".state-focus").removeClass("state-focus"),o.addClass("state-focus"),o.popup("source",i).popup("open"),o.find(":input:not(:hidden):not([disabled])").length||o.popup("close")},hotspotSelect:function(e){var i,o;o=this,o.hotspotUnselect(),i=t(e),$hotspotOverlay=i.data("hotspotOverlay"),$hotspotOverlay.addClass("selected"),$hotspotOverlay.appendTo($hotspotOverlay.parent())},hotspotUnselect:function(){var t;t=this,t.$element.find(".imageEditor-hotSpotOverlay").removeClass("selected")},hotspotRemove:function(e){var i,o,a,s,n,d,r;n=this,a=t(e),s=[a],o=a.css("left"),d=a.css("top"),r=a.css("width"),i=a.css("height"),n.$element.find(".imageEditor-hotSpotOverlay").not(a).each(function(){var e;e=t(this),e.css("left")===o&&e.css("top")===d&&e.css("width")===r&&e.css("height")===i&&s.push(e)}),t.each(s,function(t,e){var i,o;o=!e.hasClass("toBeRemoved"),i=e.data("hotspotInput"),o?(e.addClass("toBeRemoved"),n.hotspotInputMarkToBeRemoved(i)):(e.removeClass("toBeRemoved"),n.hotspotInputRestore(i),n.hotspotEdit(i))})},hotspotInputMarkToBeRemoved:function(e){var i;i=t(e),i.addClass("toBeRemoved"),i.find(":input").prop("disabled","disabled")},hotspotInputRestore:function(e){var i;i=t(e),i.removeClass("toBeRemoved"),i.find(":input").prop("disabled",!1)},hotspotOverlayRemoveAll:function(){var t;t=this,t.$element.find(".imageEditor-hotSpotOverlay").remove()},hotspotMousedownDragHandler:function(e){var i,o;return o=this,i=function(i){var a,s,n,d,r,h,p,l;return d=t(this),h=d.closest(".imageEditor-hotSpotOverlay"),p=h.find(".imageEditor-hotSpotOverlayBox"),n=h.data("hotspotInput"),l=h.position(),r={left:l.left,top:l.top,width:p.width(),height:p.height(),pageX:i.pageX,pageY:i.pageY},s=o.dom.$hotspotImage.width(),a=o.dom.$hotspotImage.height(),t.drag(this,event,function(){},function(i){var o,n,d,p;n=i.pageX-r.pageX,d=i.pageY-r.pageY,o=e(i,r,{x:n,y:d}),o=t.extend({},r,o),o.moving?(o.left<0&&(o.left=0),o.top<0&&(o.top=0),0===o.width&&(o.width=10),p=o.left+o.width-s,p>0&&(o.left-=p),p=o.top+o.height-a,p>0&&(o.top-=p)):(o.width<10&&(o.width=10),o.height<10&&(o.height=10),o.left<0&&(o.width+=o.left,o.left=0),o.top<0&&(o.height+=o.top,o.top=0),p=o.left+o.width-s,p>0&&(o.width-=p),p=o.top+o.height-a,p>0&&(o.height-=p)),h.css(o)},function(){var t;t=h.position(),o.hotspotInputSet(n,{x:t.left,y:t.top,width:p.width(),height:p.height()})}),!1}},scrollFix:function(e){var i;i=this,t(e).bind("mouswheel",function(t,e,o,a){i.elementIsScrolledToMax(this,a)&&t.preventDefault()})},elementIsScrolledToMax:function(e,i){var o,a,s,n,d;return o=this,a=t(e),s="imageEditor-maxScrollTop",n=a.data(s),d=a.scrollTop(),"undefined"==typeof n&&(n=a.prop("scrollHeight")-a.innerHeight(),a.data(s,n)),i>0&&0===d||0>i&&d>=n?!0:!1},getCanvasWidth:function(){var t,e;return t=this,e=t.dom.$image.parent().find("canvas").width()},getCanvasHeight:function(){var t,e;return t=this,e=t.dom.$image.parent().find("canvas").height()},getClickPositionInElement:function(e,i){var o,a,s,n,d,r;return o=t(e),n=o.width(),a=o.height(),s=o.offset(),d=Math.ceil(i.pageX-s.left)||1,r=Math.ceil(i.pageY-s.top)||1,0>=d&&(d=1),0>=r&&(r=1),{x:d,y:r,xPercent:d/n,yPercent:r/a,width:n,height:a}},cloneCanvas:function(e){var i,o;return t(e).is("canvas")?(o=document.createElement("canvas"),i=o.getContext("2d"),o.width=e.width,o.height=e.height,i.drawImage(e,0,0),o):t(e).clone()},getImageSize:function(e){var i,o,a,s;return i=t.Deferred(),a=t(e),s=a.prop("naturalWidth"),o=a.prop("naturalHeight"),s||o?i.resolve(s,o):(t("<img/>").on("load",function(){var e,o,a;o=t(this),a=o.prop("naturalWidth")||o.prop("width")||0,e=o.prop("naturalHeight")||o.prop("height")||0,i.resolve(a,e)}).on("error",function(){i.resolve(0,0)}).attr("src",a.attr("src")),setTimeout(function(){i.resolve(0,0)},1e4)),i.promise()},htmlDecode:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"')}},e.onDomInsert(document,".imageEditor",{insert:function(e){if(ENABLE_PADDED_CROPS){var i;i=Object.create(o),i.init(e),t(e).data("imageEditor",i)}}}),o});