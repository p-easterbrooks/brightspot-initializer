define(["jquery","bsp-utils"],function(e,t){var i;return i={defaults:{numbered:!1},classTileActive:"carousel-tile-active",classNavHide:"carousel-nav-hide",classNumbered:"carousel-numbered",eventTile:"carousel.tile",eventEnd:"carousel.end",eventBegin:"carousel.begin",eventNext:"carousel.next",eventPrevious:"carousel.previous",template:'<div class="carousel-wrapper"><div class="carousel-viewport"><ol class="carousel-tiles"></ol></div><div class="carousel-nav carousel-nav-previous"><a href="#">Previous</a></div><div class="carousel-nav carousel-nav-next"><a href="#">Next</a></div></div>',init:function(t,i){var s=this;s.element=e(t),s.settings=e.extend(!0,{},s.defaults,i),s._initHTML()},_initHTML:function(){var t=this;t.dom={},t.dom.carousel=e(t.template).appendTo(t.element),t.settings.numbered&&t.dom.carousel.addClass(t.classNumbered),t.dom.previous=t.dom.carousel.find(".carousel-nav-previous"),t.dom.next=t.dom.carousel.find(".carousel-nav-next"),t.dom.tiles=t.dom.carousel.find(".carousel-tiles"),t.dom.viewport=t.dom.carousel.find(".carousel-viewport"),t._initEvents()},_initEvents:function(){var t=this;t.dom.previous.on("click",function(e){return t.element.trigger(t.eventPrevious,{carousel:t}),t.previousPage(),!1}),t.dom.next.on("click",function(e){return t.element.trigger(t.eventNext,{carousel:t}),t.nextPage(),!1}),t.dom.tiles.on("click","> .carousel-tile",function(i){var s=e(this).index()+1;t.setActive(s),t.tileIsVisible(s)||t.goToTile(s,!0),t.doTile(s)})},addTile:function(t){var i=this;e("<li/>",{"class":"carousel-tile"}).append(t).appendTo(i.dom.tiles)},prependTile:function(t){var i,s=this,o=s._getLayout(),l=o.tilesOffset+o.tileWidth;s.dom.tiles.addClass("no-transition"),s._setOffset(l),i=e("<li/>",{"class":"carousel-tile"}).append(t).prependTo(s.dom.tiles)},removeTile:function(e){var t=this;t.dom.tiles.find("> .carousel-tile").eq(e-1).remove()},repositionTile:function(e,t){var i=this,s=i.dom.tiles.find("> .carousel-tile"),o=s.eq(e-1);t>s.length||o.length&&(o=o.detach(),1===t?i.dom.tiles.prepend(o):i.dom.tiles.find("> .carousel-tile").eq(t-2).after(o),i.update())},getTileContent:function(e){var t=this;return t.dom.tiles.find("> .carousel-tile").eq(e-1).contents()},getTileIndex:function(t){var i=e(t);return i.closest(".carousel-tile").index()+1},toggleTileError:function(e,t){var i=this,s=i.dom.tiles.find("> .carousel-tile").eq(e-1);s.toggleClass("carousel-tile-error",t)},_move:function(t){var i=this,s=i._getLayout();s.tilesOffset-=s.tilesOffset%s.tileWidth;var o=0,l=0;l=e.isNumeric(t)?t:t===!1?-s.tilesPerViewport:s.tilesPerViewport,o=s.tilesOffset+l*s.tileWidth,0>o&&(o=0),o>s.tilesWidth&&(o=s.tilesOffset),i._moveTo(o)},_moveTo:function(e){var t=this;t._setOffset(e),setTimeout(function(){t.update()},1100)},_setOffset:function(e){var t=this;t.dom.tiles.css("margin-left","-"+e+"px")},nextPage:function(){var e=this;e._move(!0)},previousPage:function(){var e=this;e._move(!1)},nextTile:function(){var e=this;e._move(1)},previousTile:function(){var e=this;e._move(-1)},goToTile:function(e,t){var i=this,s=i._getLayout(),o=(e-1)*s.tileWidth;t&&(o=o-s.viewportWidth/2+s.tileWidth/2,0>o&&(o=0)),i._moveTo(o)},goToActiveTile:function(){var e=this,t=e.getActive();e.goToTile(t,!0)},tileIsVisible:function(e){var t=this,i=t._getLayout(),s=(e-1)*i.tileWidth,o=s-i.tilesOffset,l=Boolean(o>0&&o+i.tileWidth<i.viewportWidth);return l},setActive:function(e){var t=this;t.clearActive(),t.dom.tiles.find("> .carousel-tile").eq(e-1).addClass(t.classTileActive)},getActive:function(){var t,i=this;return t=i.dom.tiles.find("> .carousel-tile").filter(function(){return e(this).hasClass(i.classTileActive)}).index()+1},clearActive:function(){var e=this;e.dom.tiles.find("> .carousel-tile").removeClass(e.classTileActive)},update:function(e){var t=this,e=t._getLayout();t.dom.tiles.removeClass("no-transition"),t.dom.previous.toggleClass(t.classNavHide,e.atMin),t.dom.next.toggleClass(t.classNavHide,e.atMax),e.atMax?t.element.trigger(t.eventEnd,{carousel:t}):e.atMin&&t.element.trigger(t.eventBegin,{carousel:t})},_getLayout:function(){var e,t=this;return e={viewportWidth:t.dom.viewport.width(),tilesWidth:t.dom.tiles.width(),tileWidth:t.dom.tiles.find("> .carousel-tile:first-child").outerWidth(!0),tilesOffset:Math.abs(parseInt(t.dom.tiles.css("margin-left"),10))||0},e.tilesPerViewport=Math.floor(e.viewportWidth/e.tileWidth),e.atMax=Boolean(e.tilesWidth-e.tilesOffset<=e.viewportWidth),e.atMin=Boolean(e.tilesOffset<=0),e},doTile:function(e){var t=this,i=t.dom.tiles.find("> .carousel-tile").eq(e-1).contents(),s={carousel:t,index:e,tile:i};t.element.trigger(t.eventTile,s)}}});