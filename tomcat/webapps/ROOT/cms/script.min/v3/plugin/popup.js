!function(e,o,p){var t=e(o),n=o.document;e.plugin2("popup",{_defaultOptions:{parent:n.body,padding:{left:10,right:10,top:10}},_create:function(o){var p=e(o),r=this.option(),a=e("<div/>",{"class":"popup"}),i=e("<div/>",{"class":"content"}),s=e("<div/>",{"class":"closeButton"}),c=p.attr("name");c&&a.attr("name",c),a.bind("open.popup",function(){e.removeData(a[0],"popup-close-cancelled");var o=e(this),p=o.data("popup-scrollLeft"),n=o.data("popup-scrollTop");"number"!=typeof p&&"number"!=typeof n&&(o.data("popup-scrollLeft",t.scrollLeft()),o.data("popup-scrollTop",t.scrollTop())),o.addClass("popup-show")}),a.bind("restoreOriginalPosition.popup",function(){var o=e(this),p=o.data("popup-scrollLeft"),n=o.data("popup-scrollTop");o.removeData("popup-scrollLeft"),o.removeData("popup-scrollTop"),"number"==typeof p&&"number"==typeof n&&(t.scrollLeft(p),t.scrollTop(n))}),a.bind("close.popup",function(){if(a.is(":visible")&&a.find(".enhancementForm, .contentForm").find(".inputContainer.state-changed").length>0&&!confirm("Are you sure you want to close this popup and discard the unsaved changes?"))return void e.data(a[0],"popup-close-cancelled",!0);e.removeData(a[0],"popup-close-cancelled");var o=e(this);o.hasClass("popup-show")&&(o.removeClass("popup-show"),o.trigger("closed"),e(".popup").each(function(){var p=e(this),t=p.popup("source");t&&e.contains(o[0],t[0])&&p.popup("close")}))}),s.bind("click.popup",function(){e(this).popup("close")});var l=e(r.parent||n.body);i.append(p),i.append(s),a.append(i),l.append(a)},open:function(){return this.$caller.popup("container").trigger("open"),this.$caller},restoreOriginalPosition:function(){return this.$caller.popup("container").trigger("restoreOriginalPosition"),this.$caller},close:function(){return this.container().trigger("close"),this.$caller},container:function(){return this.$caller.closest(".popup")},content:function(){return this.$caller.popup("container").find("> .content")},source:function(o,r){var a=this.option();if(r&&(o.height()<30||"number"!=typeof r.pageX||"number"!=typeof r.pageY)&&(r=p),"undefined"==typeof o){var i=this.$caller.popup("container")[0];return i?e.data(i,"popup-$source"):null}var s=this.$caller.popup("container");s.attr("data-popup-source-class",o.prop("class")),s.each(function(){e.data(this,"popup-$source",o)});var c=o.offset(),l=s.outerWidth(),u=0,d=r?r.pageX-l/2:c.left+(o.outerWidth()-l)/2;if(d<a.padding.left)u=d-a.padding.left,d=a.padding.left;else{var f=d+l-e(n).width()+a.padding.right;f>0&&(u=f,d-=f)}var h=s.popup("content"),g=h.find("> .marker");0===g.length&&(g=e("<div/>",{"class":"marker"}),h.append(g));var v=(l-20)/2+u;g.css("left",5>v?5:v);var m=r?r.pageY:c.top+o.outerHeight();30>m&&(m=30);var y=o.isFixedPosition();y&&(d-=e(window).scrollLeft(),m-=e(window).scrollTop());var b=o.closest(".popup");return 0===b.length&&(b=o.parent()),y&&m/t.height()>.3&&s.addClass("popup-fixed"),s.css({left:d,margin:0,position:y?"fixed":"absolute",top:m,"z-index":o.parent().zIndex()+1}),this.$caller}}),t.click(function(o){var p=o.target,t=e(p);if(!(t.closest("#context-menu-layer, .context-menu-root, .search-reset, .queryField_frames").length>0)){var n=t.popup("container");if(n.length>0){var r=n.find("> .content");0!==r.length&&e.contains(r[0],p)||n.popup("close")}else e(".popup").each(function(){var o=e(this),t=o.popup("source");if(t&&t.length>0){var n=t[0];if(n===p||e.contains(n,p))return}o.popup("close")})}}),t.keydown(function(o){if(27===o.which){var p=e(".popup");return p.length>0?(p.popup("close"),!1):!0}})}(jQuery,window);