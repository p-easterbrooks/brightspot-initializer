define(["jquery","bsp-utils"],function(o,e){function l(o){return"fixed"===o.css("position")}function t(){var e=o(this),t=e.closest(".popup");if(!l(t))return void e.removeClass("fixedScrollableArea");var i=e.scrollTop();e.addClass("fixedScrollableArea"),e.css("max-height","");var n=e.offset().top,c=t.outerHeight(!0)-e.outerHeight(!0)-n+t.offset().top;e.css("max-height",r.height()-n+r.scrollTop()-c-20),e.scrollTop(i)}var r=o(window);return e.plugin(window,"bsp","fixedScrollable",{_init:function(e,i){var n=o(e);o(document).ready(function(){var e=o.throttle(100,function(e){o.data(e[0],"fixedScrollable-maxScrollTop",e.prop("scrollHeight")-e.innerHeight())});n.on("mousewheel",i,function(t,r,i,n){var c=o(this);l(c.closest(".popup"))&&(e(c),(n>0&&0===c.scrollTop()||0>n&&c.scrollTop()>=o.data(c[0],"fixedScrollable-maxScrollTop"))&&t.preventDefault())})}),r.resize(o.throttle(100,function(){n.find(i).each(t)}))},_each:function(e){t.call(o(e))}})});